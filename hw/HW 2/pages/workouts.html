<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workouts Library - Fitness Platform</title>
    <meta name="description" content="Browse our collection of fitness workouts for all levels">
    <meta name="color-scheme" content="light dark">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Основные стили уже в style.css, здесь только специфичные */
        .workout-meta-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.3rem;
            font-size: 0.85rem;
        }
        
        .workout-meta-item i {
            width: 20px;
            color: #2c5282;
            margin-right: 0.5rem;
        }
        
        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: 3rem;
        }
        
        .loading-spinner {
            grid-column: 1 / -1;
            text-align: center;
            padding: 3rem;
        }
        
        @media (max-width: 768px) {
            .workout-image-container {
                height: 160px;
            }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-to-content" aria-label="Skip to main content">Skip to main content</a>
    
    <div class="container">
        <div class="mb-3">
            <a href="../index.html" class="btn btn-back light-blue-text" aria-label="Return to homepage">
                <i class="fas fa-arrow-left me-2" aria-hidden="true"></i>Back to Home
            </a>
        </div>
        
        <main id="main-content" tabindex="-1">
            <h1 class="visually-hidden">Workouts Library - Browse available fitness workouts</h1>
            
            <h2 class="form-title" id="workouts-heading">
                <i class="fas fa-dumbbell me-3" aria-hidden="true"></i>Workouts Library
            </h2>
            
            <!-- Фильтры -->
            <section class="card glass-card mb-4" aria-labelledby="filter-heading">
                <div class="card-body">
                    <h3 id="filter-heading" class="light-blue-text mb-3">
                        <i class="fas fa-filter me-2" aria-hidden="true"></i>Filter Workouts
                    </h3>
                    <form id="filterForm" role="search" aria-label="Filter workouts form">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="levelFilter" class="form-label">Difficulty Level</label>
                                <select class="form-select" id="levelFilter" aria-label="Select difficulty level">
                                    <option value="all">All Levels</option>
                                    <option value="beginner">Beginner</option>
                                    <option value="intermediate">Intermediate</option>
                                    <option value="advanced">Advanced</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="typeFilter" class="form-label">Workout Type</label>
                                <select class="form-select" id="typeFilter" aria-label="Select workout type">
                                    <option value="all">All Types</option>
                                    <option value="cardio">Cardio</option>
                                    <option value="strength">Strength</option>
                                    <option value="yoga">Yoga</option>
                                    <option value="stretching">Stretching</option>
                                    <option value="hiit">HIIT</option>
                                    <option value="power-lifting">Power Lifting</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="durationFilter" class="form-label">Duration</label>
                                <select class="form-select" id="durationFilter" aria-label="Select workout duration">
                                    <option value="all">All Durations</option>
                                    <option value="short">Short (20 min)</option>
                                    <option value="medium">Medium (30 min)</option>
                                    <option value="long">Long (45 min)</option>
                                </select>
                            </div>
                            <div class="col-12 mt-2">
                                <button id="applyFilters" type="button" class="btn btn-form-primary btn-sm me-2" aria-label="Apply selected filters">
                                    <i class="fas fa-check me-1" aria-hidden="true"></i>Apply Filters
                                </button>
                                <button id="resetFilters" type="button" class="btn btn-outline-secondary btn-sm" aria-label="Reset all filters to default">
                                    <i class="fas fa-redo me-1" aria-hidden="true"></i>Reset Filters
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </section>
            
            <!-- Результаты -->
            <div class="alert alert-info mb-4 py-3" role="status" aria-live="polite" id="resultsInfo">
                <div class="d-flex align-items-center">
                    <i class="fas fa-info-circle me-2" aria-hidden="true"></i>
                    <span id="workoutCount">Loading workouts...</span>
                </div>
            </div>
            
            <!-- Грид с тренировками -->
            <section aria-labelledby="workouts-list-heading">
                <h3 id="workouts-list-heading" class="visually-hidden">Workouts List</h3>
                <div class="workouts-grid" id="workoutContainer" role="list" aria-label="List of available workouts">
                    <!-- Тренировки будут загружены через JavaScript -->
                </div>
            </section>
            
            <!-- Сообщение если тренировки не найдены -->
            <div id="noWorkoutsMessage" class="no-results visually-hidden" role="alert" aria-live="assertive">
                <div class="card glass-card">
                    <div class="card-body py-5 text-center">
                        <i class="fas fa-dumbbell fa-4x light-blue-text mb-3" aria-hidden="true"></i>
                        <h4 class="light-blue-text h5 mb-2">No workouts found</h4>
                        <p class="text-muted mb-4">Try adjusting your filters or check back later for new workouts.</p>
                        <button id="resetFiltersBtn" class="btn btn-form-primary" aria-label="Reset filters and show all workouts">
                            <i class="fas fa-redo me-1" aria-hidden="true"></i>Reset Filters
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
    // API URL
    const API_URL = 'http://localhost:3000/api';

    let allWorkouts = [];

    const IMAGE_MAP = {
        'cardio': 'http://localhost:3000/images/cardio.jpeg',
        'strength': 'http://localhost:3000/images/strength.jpeg',
        'yoga': 'http://localhost:3000/images/yoga.jpeg',
        'stretching': 'http://localhost:3000/images/stretching.jpeg',
        'hiit': 'http://localhost:3000/images/hiit.jpeg', 
        'hitt': 'http://localhost:3000/images/hiit.jpeg',
        'power-lifting': 'http://localhost:3000/images/power-lifting.jpeg',
        'powerlifting': 'http://localhost:3000/images/power-lifting.jpeg',
        'default': 'http://localhost:3000/images/workout.jpg'
    };

    // Обновление информации о результатах
    function updateResultsInfo(count) {
        const resultsInfo = document.getElementById('resultsInfo');
        const workoutCount = document.getElementById('workoutCount');
        
        if (resultsInfo && workoutCount) {
            if (count === 0) {
                resultsInfo.className = 'alert alert-warning mb-4 py-3';
                workoutCount.textContent = 'No workouts found matching your criteria. Try adjusting your filters.';
            } else {
                resultsInfo.className = 'alert alert-info mb-4 py-3';
                workoutCount.textContent = `Found ${count} workout${count !== 1 ? 's' : ''}`;
            }
        }
    }

    // Исправление URL изображения
    function fixImageUrl(workout) {
        if (workout.image && workout.image.includes('localhost:3000/images/')) {
            return workout.image;
        }
        
        if (workout.image && workout.image.includes('../images/')) {
            const imageName = workout.image.split('/').pop();
            return `http://localhost:3000/images/${imageName}`;
        }
        
        let type = (workout.type || '').toLowerCase().trim();
        
        if (type === 'hiit' || type === 'hitt') {
            type = 'hiit';
        }
        
        if (type.includes('power')) {
            type = 'power-lifting';
        }
        
        return IMAGE_MAP[type] || IMAGE_MAP.default;
    }

    // Функция для обработки ошибок изображений
    function handleImageError(imgElement) {
        console.warn('Image failed to load:', imgElement.src);
        imgElement.src = 'http://localhost:3000/images/workout.jpg';
        imgElement.alt = 'Default workout image';
        imgElement.onerror = null;
    }

    // Загрузка тренировок
    async function loadWorkouts() {
        try {
            const container = document.getElementById('workoutContainer');
            container.innerHTML = `
                <div class="loading-spinner">
                    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                        <span class="visually-hidden">Loading workouts...</span>
                    </div>
                    <p class="mt-3">Loading workouts...</p>
                </div>
            `;
            
            const response = await fetch(`${API_URL}/workouts`);
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            
            const workouts = await response.json();
            
            allWorkouts = workouts.map(workout => {
                return {
                    ...workout,
                    image: fixImageUrl(workout)
                };
            });
            
            displayWorkouts(allWorkouts);
            updateResultsInfo(allWorkouts.length);
            
        } catch (error) {
            console.error('Error loading workouts:', error);
            const container = document.getElementById('workoutContainer');
            container.innerHTML = `
                <div class="no-results">
                    <div class="alert alert-warning" role="alert">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-exclamation-triangle me-3 fa-2x" aria-hidden="true"></i>
                            <div>
                                <h4 class="h5 mb-2">Could not load workouts</h4>
                                <p class="mb-3">The server might not be running. Please try again later.</p>
                                <button onclick="location.reload()" class="btn btn-warning" aria-label="Try loading workouts again">
                                    <i class="fas fa-redo me-1" aria-hidden="true"></i>Try Again
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            updateResultsInfo(0);
        }
    }

    // Отображение тренировок (три в ряд, одинакового размера)
    function displayWorkouts(workouts) {
        const container = document.getElementById('workoutContainer');
        const noWorkoutsMessage = document.getElementById('noWorkoutsMessage');
        
        if (!workouts || workouts.length === 0) {
            container.innerHTML = '';
            if (noWorkoutsMessage) {
                noWorkoutsMessage.classList.remove('visually-hidden');
            }
            updateResultsInfo(0);
            return;
        }
        
        if (noWorkoutsMessage) {
            noWorkoutsMessage.classList.add('visually-hidden');
        }
        
        updateResultsInfo(workouts.length);
        
        let html = '';
        workouts.forEach((workout, index) => {
            let levelBadgeClass = 'badge-secondary';
            let levelText = workout.level || 'intermediate';
            
            if (levelText === 'beginner') levelBadgeClass = 'badge-beginner';
            if (levelText === 'intermediate') levelBadgeClass = 'badge-intermediate';
            if (levelText === 'advanced') levelBadgeClass = 'badge-advanced';
            
            const durationText = workout.duration === 'short' ? '20 min' : 
                                workout.duration === 'medium' ? '30 min' : 
                                workout.duration === 'long' ? '45 min' : '30 min';
            
            const caloriesText = workout.calories || '300-400';
            const equipmentText = workout.equipment || 'None required';
            
            html += `
                <article class="workout-card-uniform" role="listitem" aria-labelledby="workout-title-${workout.id}">
                    <!-- Изображение (полностью заполняет контейнер) -->
                    <div class="workout-image-container">
                        <img src="${workout.image}" 
                             class="workout-image" 
                             alt="${workout.name} - ${workout.type} workout"
                             onerror="handleImageError(this)"
                             loading="lazy"
                             width="400" 
                             height="200">
                    </div>
                    
                    <!-- Контент карточки -->
                    <div class="workout-card-body">
                        <!-- Заголовок и бейдж уровня -->
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h3 id="workout-title-${workout.id}" class="workout-title">${workout.name}</h3>
                            <span class="workout-badge ${levelBadgeClass}" aria-label="Difficulty level: ${levelText}">
                                ${levelText}
                            </span>
                        </div>
                        
                        <!-- Описание -->
                        <p class="workout-description">${workout.description || 'A great workout for your fitness goals.'}</p>
                        
                        <!-- Бейджи -->
                        <div class="workout-badges">
                            <span class="workout-badge badge-type" aria-label="Workout type: ${workout.type}">
                                ${workout.type || 'Workout'}
                            </span>
                            <span class="workout-badge badge-duration" aria-label="Duration: ${durationText}">
                                ${durationText}
                            </span>
                        </div>
                        
                        <!-- Мета-информация -->
                        <div class="workout-meta">
                            <div class="workout-meta-item">
                                <i class="fas fa-fire" aria-hidden="true"></i>
                                <span>Calories: ${caloriesText}</span>
                            </div>
                            <div class="workout-meta-item">
                                <i class="fas fa-dumbbell" aria-hidden="true"></i>
                                <span>Equipment: ${equipmentText}</span>
                            </div>
                        </div>
                        
                        <!-- Кнопка View Details (контрастная и светлая) -->
                        <a href="workout-details.html?id=${workout.id}" 
                           class="btn-view-details-uniform"
                           aria-label="View details for ${workout.name} workout"
                           id="workout-link-${workout.id}">
                            <i class="fas fa-info-circle me-1" aria-hidden="true"></i>View Details
                        </a>
                    </div>
                </article>
            `;
        });
        
        container.innerHTML = html;
        
        // Добавляем обработчики ошибок для изображений
        document.querySelectorAll('.workout-image').forEach(img => {
            img.addEventListener('error', function() {
                handleImageError(this);
            });
        });
    }

    // Фильтрация тренировок
    function filterWorkouts() {
        const level = document.getElementById('levelFilter').value;
        const type = document.getElementById('typeFilter').value;
        const duration = document.getElementById('durationFilter').value;
        
        const filtered = allWorkouts.filter(workout => {
            return (level === 'all' || workout.level === level) &&
                   (type === 'all' || workout.type === type) &&
                   (duration === 'all' || workout.duration === duration);
        });
        
        displayWorkouts(filtered);
    }

    // Сброс фильтров
    function resetFilters() {
        document.getElementById('levelFilter').value = 'all';
        document.getElementById('typeFilter').value = 'all';
        document.getElementById('durationFilter').value = 'all';
        displayWorkouts(allWorkouts);
    }

    // Инициализация
    document.addEventListener('DOMContentLoaded', function() {
        loadWorkouts();
        
        const applyBtn = document.getElementById('applyFilters');
        const resetBtn = document.getElementById('resetFilters');
        const resetFiltersBtn = document.getElementById('resetFiltersBtn');
        
        if (applyBtn) {
            applyBtn.addEventListener('click', filterWorkouts);
        }
        
        if (resetBtn) {
            resetBtn.addEventListener('click', resetFilters);
        }
        
        if (resetFiltersBtn) {
            resetFiltersBtn.addEventListener('click', resetFilters);
        }
        
        const filterForm = document.getElementById('filterForm');
        if (filterForm) {
            filterForm.addEventListener('submit', function(e) {
                e.preventDefault();
                filterWorkouts();
            });
        }
        
        // Клавиатурная навигация
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.target.tagName === 'BUTTON') {
                e.target.click();
            }
        });
    });

    // Экспорт функций для глобального использования
    window.filterWorkouts = filterWorkouts;
    window.resetFilters = resetFilters;
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../script.js"></script>
</body>
</html>