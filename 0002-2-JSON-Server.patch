From 08ad77cd3ffff651d81e0da7284ea78904364fc6 Mon Sep 17 00:00:00 2001
From: lizagrishuk <lizagrishuk05@gmail.com>
Date: Thu, 11 Dec 2025 23:05:20 +0300
Subject: [PATCH 2/3] =?UTF-8?q?=D0=9B=D0=B0=D0=B1=D0=B0=202:=20=D0=BF?=
 =?UTF-8?q?=D0=BE=D0=B4=D0=BA=D0=BB=D1=8E=D1=87=D0=B5=D0=BD=D0=B8=D0=B5=20?=
 =?UTF-8?q?=D0=BA=20JSON=20Server,=20=D1=80=D0=B5=D0=B3=D0=B8=D1=81=D1=82?=
 =?UTF-8?q?=D1=80=D0=B0=D1=86=D0=B8=D1=8F,=20=D0=B2=D1=85=D0=BE=D0=B4,=20?=
 =?UTF-8?q?=D0=B1=D1=80=D0=BE=D0=BD=D0=B8=D1=80=D0=BE=D0=B2=D0=B0=D0=BD?=
 =?UTF-8?q?=D0=B8=D0=B5?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 lab1/js/script.js | 115 ++++++++++++++++++++++------------------------
 1 file changed, 54 insertions(+), 61 deletions(-)

diff --git a/lab1/js/script.js b/lab1/js/script.js
index 3d4fabd..677b065 100644
--- a/lab1/js/script.js
+++ b/lab1/js/script.js
@@ -1,10 +1,19 @@
 document.addEventListener('DOMContentLoaded', () => {
-  const restaurantsData = [
-    {id:1, name:"La Piazza", cuisine:"Итальянская", location:"Центр", price:2, img:"img/sample-restaurant.jpg"},
-    {id:2, name:"Sushi Time", cuisine:"Японская", location:"Север", price:3, img:"img/sample-sushi.jpg"}
-  ];
-
   const list = document.getElementById('restaurants');
+  const bookingModalEl = document.getElementById('bookingModal');
+  const bookingModal = new bootstrap.Modal(bookingModalEl);
+  const bookingTitle = document.getElementById('bookingTitle');
+  const bookingForm = document.getElementById('bookingForm');
+  let currentRestaurants = [];
+
+  // Получение ресторанов с сервера
+  fetch('http://localhost:3000/restaurants')
+    .then(res => res.json())
+    .then(data => {
+      currentRestaurants = data;
+      render(currentRestaurants);
+    })
+    .catch(err => console.error('Ошибка при получении ресторанов:', err));
 
   function render(arr) {
     list.innerHTML = '';
@@ -17,21 +26,15 @@ document.addEventListener('DOMContentLoaded', () => {
           <div class="card-body">
             <h5 class="card-title">${r.name}</h5>
             <p class="card-text text-muted">${r.cuisine} · ${r.location} · ${'₽'.repeat(r.price)}</p>
-
             <div class="d-flex gap-2">
               <button class="btn btn-outline-secondary btn-more" data-id="${r.id}">Подробнее</button>
               <button class="btn btn-primary btn-book" data-id="${r.id}" data-name="${r.name}">Забронировать</button>
-              </div>
+            </div>
           </div>
         </div>`;
       list.appendChild(col);
     });
 
-    const bookingModalEl = document.getElementById('bookingModal');
-    const bookingModal = new bootstrap.Modal(bookingModalEl);
-    const bookingTitle = document.getElementById('bookingTitle');
-    const bookingForm = document.getElementById('bookingForm');
-
     document.querySelectorAll('.btn-book').forEach(btn => {
       btn.addEventListener('click', e => {
         const id = e.currentTarget.dataset.id;
@@ -51,56 +54,46 @@ document.addEventListener('DOMContentLoaded', () => {
         window.location.href = `restaurant.html?id=${id}`;
       });
     });
-
-    bookingForm.addEventListener('submit', e => {
-      e.preventDefault();
-
-      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
-      if (!currentUser) {
-        alert('Сначала войдите в аккаунт');
-        return;
-      }
-
-      const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
-
-      bookings.push({
-        email: currentUser.email,
-        id: document.getElementById('restaurantId').value,
-        name: bookingTitle.textContent.replace('Бронирование: ',''),
-        date: document.getElementById('bookingDate').value,
-        guests: document.getElementById('guestsCount').value
-      });
-
-      localStorage.setItem('bookings', JSON.stringify(bookings));
-      alert('Бронирование сохранено');
-      bookingModal.hide();
-    });
   }
 
-  render(restaurantsData);
-
-  // фильтры
+  // Фильтры
   document.getElementById('applyFilters').addEventListener('click', () => {
-  const cuisine = document.getElementById('filterCuisine').value.trim();
-  const location = document.getElementById('filterLocation').value.trim().toLowerCase();
-  const price = document.getElementById('filterPrice').value;
-
-  let filtered = restaurantsData;
-
-  if (cuisine !== "") {
-    filtered = filtered.filter(r => r.cuisine === cuisine);
-  }
-
-  if (location !== "") {
-    filtered = filtered.filter(r => r.location.toLowerCase().includes(location));
-  }
-
-  if (price !== "") {
-    filtered = filtered.filter(r => r.price <= Number(price));
-  }
-
-  render(filtered);
-});
-
-
+    const cuisine = document.getElementById('filterCuisine').value.trim();
+    const location = document.getElementById('filterLocation').value.trim().toLowerCase();
+    const price = document.getElementById('filterPrice').value;
+
+    let filtered = currentRestaurants;
+    if (cuisine !== "") filtered = filtered.filter(r => r.cuisine === cuisine);
+    if (location !== "") filtered = filtered.filter(r => r.location.toLowerCase().includes(location));
+    if (price !== "") filtered = filtered.filter(r => r.price <= Number(price));
+
+    render(filtered);
+  });
+
+  // Бронирование через API
+  bookingForm.addEventListener('submit', e => {
+    e.preventDefault();
+    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
+    if (!currentUser) { alert('Сначала войдите в аккаунт'); return; }
+
+    const booking = {
+      email: currentUser.email,
+      id: document.getElementById('restaurantId').value,
+      name: bookingTitle.textContent.replace('Бронирование: ', ''),
+      date: document.getElementById('bookingDate').value,
+      guests: document.getElementById('guestsCount').value
+    };
+
+    fetch('http://localhost:3000/bookings', {
+      method: 'POST',
+      headers: { 'Content-Type': 'application/json' },
+      body: JSON.stringify(booking)
+    })
+    .then(res => res.json())
+    .then(data => {
+      alert('Бронирование сохранено на сервере!');
+      bookingModal.hide();
+    })
+    .catch(err => console.error('Ошибка при сохранении бронирования:', err));
+  });
 });
-- 
2.42.0.windows.2

