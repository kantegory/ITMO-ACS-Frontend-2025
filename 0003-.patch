From b781d2e8ad01c5e44c618880ea71df7cebdae7b0 Mon Sep 17 00:00:00 2001
From: lizagrishuk <lizagrishuk05@gmail.com>
Date: Fri, 12 Dec 2025 00:58:03 +0300
Subject: [PATCH 3/3] =?UTF-8?q?=D0=B8=D1=81=D0=BF=D1=80=D0=B0=D0=B2=D0=BB?=
 =?UTF-8?q?=D0=B5=D0=BD=D0=B8=D0=B5=20=D0=BE=D1=88=D0=B8=D0=B1=D0=BE=D0=BA?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 lab1/account.html     | 80 +++++++++++++++++--------------------------
 lab1/index.html       |  8 ++---
 lab1/js/auth.js       | 65 ++++++++++++-----------------------
 lab1/js/restaurant.js | 72 ++++++++++++++++----------------------
 lab1/js/script.js     | 74 +++++++++++++++++++--------------------
 5 files changed, 122 insertions(+), 177 deletions(-)

diff --git a/lab1/account.html b/lab1/account.html
index ffd09fd..6d63d4f 100644
--- a/lab1/account.html
+++ b/lab1/account.html
@@ -1,54 +1,38 @@
-<!doctype html>
-<html lang="ru">
-<head>
-  <meta charset="utf-8">
-  <meta name="viewport" content="width=device-width, initial-scale=1">
-  <title>Личный кабинет — RestaurantBooking</title>
-
-  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
-  <link href="css/styles.css" rel="stylesheet">
-</head>
-<body class="bg-light">
-
-<nav class="navbar navbar-light bg-white shadow-sm">
-  <div class="container">
-    <a class="navbar-brand" href="index.html">RestaurantBooking</a>
-  </div>
-</nav>
-
-<div class="container mt-5">
-  <div class="card p-4 shadow">
-    <h2 class="mb-3">Личный кабинет</h2>
+document.addEventListener('DOMContentLoaded', async () => {
+  const currentUser = JSON.parse(localStorage.getItem('currentUser'));
+  if (!currentUser) return window.location.href = 'login.html';
 
-    <p class="lead" id="userGreeting">Добро пожаловать!</p>
+  document.getElementById('userGreeting').textContent = `Добро пожаловать, ${currentUser.name}!`;
 
-    <div class="d-flex gap-3 mt-4">
-      <a href="history.html" class="btn btn-primary">История бронирований</a>
-      <button id="logoutBtn" class="btn btn-outline-danger">Выйти</button>
-    </div>
-  </div>
-</div>
+  document.getElementById('logoutBtn').addEventListener('click', () => {
+    localStorage.removeItem('currentUser');
+    window.location.href = 'login.html';
+  });
 
-<script>
-document.addEventListener('DOMContentLoaded', () => {
-  // Проверяем текущего пользователя
-  const currentUser = JSON.parse(localStorage.getItem('currentUser'));
-  if (!currentUser) {
-    window.location.href = 'login.html'; // перенаправление на вход
-  } else {
-    // Подставляем имя пользователя в приветствие
-    const userGreeting = document.getElementById('userGreeting');
-    userGreeting.textContent = `Добро пожаловать, ${currentUser.name}!`;
+  // получаем бронирования с сервера
+  try {
+    const res = await fetch(`http://localhost:3000/bookings?email=${encodeURIComponent(currentUser.email)}`);
+    const bookings = await res.json();
+
+    const userBookings = document.getElementById('userBookings');
+    if (!bookings.length) {
+      userBookings.innerHTML = '<p class="text-muted">Бронирований пока нет</p>';
+    } else {
+      userBookings.innerHTML = '';
+      bookings.forEach(b => {
+        const item = document.createElement('div');
+        item.className = 'list-group-item';
+        item.innerHTML = `
+          <h5>${b.name}</h5>
+          <p class="mb-1">Дата: ${b.date}</p>
+          <small>Гостей: ${b.guests}</small>
+        `;
+        userBookings.appendChild(item);
+      });
+    }
+  } catch (err) {
+    document.getElementById('userBookings').innerHTML = '<p class="text-danger">Ошибка загрузки бронирований</p>';
+    console.error(err);
   }
-
-  // Кнопка "Выйти"
-  const logoutBtn = document.getElementById('logoutBtn');
-  logoutBtn.addEventListener('click', () => {
-    localStorage.removeItem('currentUser'); // удаляем текущего пользователя
-    window.location.href = 'login.html';   // возвращаем на страницу входа
-  });
 });
-</script>
 
-</body>
-</html>
diff --git a/lab1/index.html b/lab1/index.html
index fc19d5a..68c6056 100644
--- a/lab1/index.html
+++ b/lab1/index.html
@@ -2,13 +2,13 @@
 <html lang="ru">
 <head>
   <meta charset="utf-8">
-  <meta name="viewport" content="width=device-width,initial-scale=1">
+  <meta name="viewport" content="width=device-width, initial-scale=1">
   <title>Поиск ресторанов — RestaurantBooking</title>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
   <link href="css/styles.css" rel="stylesheet">
 </head>
 <body>
-<nav class="navbar navbar-expand-lg navbar-light bg-light">
+<nav class="navbar navbar-light bg-light">
   <div class="container">
     <a class="navbar-brand" href="#">RestaurantBooking</a>
     <div class="d-flex">
@@ -52,10 +52,10 @@
 
   <hr>
 
-  <div id="restaurants" class="row row-cols-1 row-cols-md-2 g-3">
-  </div>
+  <div id="restaurants" class="row row-cols-1 row-cols-md-2 g-3"></div>
 </div>
 
+<!-- Модальное окно бронирования -->
 <div class="modal fade" id="bookingModal" tabindex="-1" aria-hidden="true">
   <div class="modal-dialog">
     <form id="bookingForm" class="modal-content">
diff --git a/lab1/js/auth.js b/lab1/js/auth.js
index 5cd536a..596bb8c 100644
--- a/lab1/js/auth.js
+++ b/lab1/js/auth.js
@@ -1,62 +1,63 @@
 document.addEventListener('DOMContentLoaded', () => {
 
-  // Регистрация
+  // ---------------- Регистрация ----------------
   const registerForm = document.getElementById('registerForm');
   if (registerForm) {
-    registerForm.addEventListener('submit', e => {
+    registerForm.addEventListener('submit', async e => {
       e.preventDefault();
-
       const name = document.getElementById('regName').value.trim();
       const email = document.getElementById('regEmail').value.trim();
       const password = document.getElementById('regPassword').value;
 
-      // Получаем пользователей из localStorage
-      const users = JSON.parse(localStorage.getItem('users') || '[]');
-
-      // Проверка: уже есть пользователь с таким email
-      if (users.find(u => u.email === email)) {
+      // проверка, есть ли пользователь
+      const res = await fetch(`http://localhost:3000/users?email=${encodeURIComponent(email)}`);
+      const existing = await res.json();
+      if (existing.length > 0) {
         alert('Пользователь с таким email уже зарегистрирован');
         return;
       }
 
-      users.push({ name, email, password });
-      localStorage.setItem('users', JSON.stringify(users));
+      // добавляем нового пользователя
+      await fetch('http://localhost:3000/users', {
+        method: 'POST',
+        headers: { 'Content-Type': 'application/json' },
+        body: JSON.stringify({ name, email, password })
+      });
 
       alert('Регистрация прошла успешно');
       window.location.href = 'login.html';
     });
   }
 
-  // Вход 
+  // ---------------- Вход ----------------
   const loginForm = document.getElementById('loginForm');
   if (loginForm) {
-    loginForm.addEventListener('submit', e => {
+    loginForm.addEventListener('submit', async e => {
       e.preventDefault();
-
       const email = document.getElementById('loginEmail').value.trim();
       const password = document.getElementById('loginPassword').value;
 
-      const users = JSON.parse(localStorage.getItem('users') || '[]');
-      const user = users.find(u => u.email === email && u.password === password);
+      const res = await fetch(`http://localhost:3000/users?email=${encodeURIComponent(email)}&password=${encodeURIComponent(password)}`);
+      const users = await res.json();
 
-      if (!user) {
+      if (users.length === 0) {
         alert('Неверный email или пароль');
         return;
       }
 
-      // Сохраняем текущего пользователя
+      const user = users[0];
       localStorage.setItem('currentUser', JSON.stringify(user));
       window.location.href = 'account.html';
     });
   }
 
-  //  Личный кабинет 
+  // ---------------- Личный кабинет ----------------
   const userGreeting = document.getElementById('userGreeting');
   const logoutBtn = document.getElementById('logoutBtn');
+
   if (userGreeting) {
     const currentUser = JSON.parse(localStorage.getItem('currentUser'));
     if (!currentUser) {
-      // если не авторизован — на login
       window.location.href = 'login.html';
     } else {
       userGreeting.textContent = `Добро пожаловать, ${currentUser.name}!`;
@@ -69,29 +70,5 @@ document.addEventListener('DOMContentLoaded', () => {
       window.location.href = 'login.html';
     });
   }
-
-  // История бронирований
-  const historyList = document.getElementById('historyList');
-  if (historyList) {
-    const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
-    const currentUser = JSON.parse(localStorage.getItem('currentUser'));
-
-    const userBookings = bookings.filter(b => b.email === currentUser?.email);
-
-    if (userBookings.length === 0) {
-      historyList.innerHTML = '<p class="text-muted">Бронирований пока нет</p>';
-    } else {
-      userBookings.forEach(b => {
-        const item = document.createElement('div');
-        item.className = 'list-group-item';
-        item.innerHTML = `
-          <h5>${b.name}</h5>
-          <p class="mb-1">Дата: ${b.date}</p>
-          <small>Гостей: ${b.guests}</small>
-        `;
-        historyList.appendChild(item);
-      });
-    }
-  }
-
 });
+
diff --git a/lab1/js/restaurant.js b/lab1/js/restaurant.js
index a726da4..035d5ce 100644
--- a/lab1/js/restaurant.js
+++ b/lab1/js/restaurant.js
@@ -1,57 +1,43 @@
-document.addEventListener('DOMContentLoaded', () => {
+document.addEventListener('DOMContentLoaded', async () => {
   const params = new URLSearchParams(window.location.search);
   const id = Number(params.get('id'));
-
-  const restaurants = [
-    {id:1, name:"La Piazza", cuisine:"Итальянская", location:"Центр", price:2, img:"img/sample-restaurant.jpg",
-      description:"Уютный итальянский ресторан с домашней пастой и печёной пиццей.",
-      menu:["Пицца Маргарита", "Паста Карбонара", "Тирамису"],
-      reviews:[
-        "Очень вкусно, как в Италии! ⭐⭐⭐⭐⭐",
-        "Лучшее место для ужина вдвоём. ⭐⭐⭐⭐⭐",
-        "Понравилось обслуживание. ⭐⭐⭐⭐⭐"
-      ]
-    },
-    {id:2, name:"Sushi Time", cuisine:"Японская", location:"Север", price:3, img:"img/sample-sushi.jpg",
-      description:"Современный суши-бар с авторскими роллами и свежей рыбой.",
-      menu:["Филадельфия", "Темпура ролл", "Рамен"],
-      reviews:[
-        "Рыба очень свежая! ⭐⭐⭐⭐⭐",
-        "Быстрая подача, вкусные роллы. ⭐⭐⭐⭐⭐",
-        "Лучшая японская кухня в городе. ⭐⭐⭐⭐⭐"
-      ]
-    }
-  ];
-
-  const restaurant = restaurants.find(r => r.id === id);
   const container = document.getElementById('restaurantContainer');
 
-  if (!restaurant) {
+  if (!id) {
     container.innerHTML = `<h2>Ресторан не найден</h2>`;
     return;
   }
 
-  container.innerHTML = `
-    <div class="card p-4 shadow">
-      <div class="row">
-        <div class="col-md-5">
-          <img src="${restaurant.img}" class="img-fluid rounded" alt="">
-        </div>
-        <div class="col-md-7">
-          <h2>${restaurant.name}</h2>
-          <p class="text-muted">${restaurant.cuisine} · ${restaurant.location} · ${"₽".repeat(restaurant.price)}</p>
-          <p>${restaurant.description}</p>
+  try {
+    // Получаем данные конкретного ресторана с сервера
+    const res = await fetch(`http://localhost:3000/restaurants/${id}`);
+    if (!res.ok) throw new Error('Ресторан не найден');
+    const restaurant = await res.json();
 
-          <h4 class="mt-3">Меню</h4>
-          <ul>${restaurant.menu.map(i => `<li>${i}</li>`).join("")}</ul>
+    container.innerHTML = `
+      <div class="card p-4 shadow">
+        <div class="row">
+          <div class="col-md-5">
+            <img src="${restaurant.img}" class="img-fluid rounded" alt="">
+          </div>
+          <div class="col-md-7">
+            <h2>${restaurant.name}</h2>
+            <p class="text-muted">${restaurant.cuisine} · ${restaurant.location} · ${"₽".repeat(restaurant.price)}</p>
+            <p>${restaurant.description}</p>
 
-          <h4 class="mt-3">Отзывы</h4>
-          <ul>${restaurant.reviews.map(i => `<li>${i}</li>`).join("")}</ul>
+            <h4 class="mt-3">Меню</h4>
+            <ul>${restaurant.menu.map(i => `<li>${i}</li>`).join("")}</ul>
 
-          <a href="index.html" class="btn btn-secondary mt-3">Назад</a>
-          <a href="index.html#booking" class="btn btn-primary mt-3">Забронировать</a>
+            <h4 class="mt-3">Отзывы</h4>
+            <ul>${restaurant.reviews.map(i => `<li>${i}</li>`).join("")}</ul>
+
+            <a href="index.html" class="btn btn-secondary mt-3">Назад</a>
+            <a href="index.html#booking" class="btn btn-primary mt-3">Забронировать</a>
+          </div>
         </div>
       </div>
-    </div>
-  `;
+    `;
+  } catch (err) {
+    container.innerHTML = `<h2>${err.message}</h2>`;
+  }
 });
diff --git a/lab1/js/script.js b/lab1/js/script.js
index 677b065..7cd8fbe 100644
--- a/lab1/js/script.js
+++ b/lab1/js/script.js
@@ -4,16 +4,16 @@ document.addEventListener('DOMContentLoaded', () => {
   const bookingModal = new bootstrap.Modal(bookingModalEl);
   const bookingTitle = document.getElementById('bookingTitle');
   const bookingForm = document.getElementById('bookingForm');
+
   let currentRestaurants = [];
 
-  // Получение ресторанов с сервера
+  // ---------------- Получаем рестораны ----------------
   fetch('http://localhost:3000/restaurants')
     .then(res => res.json())
     .then(data => {
       currentRestaurants = data;
       render(currentRestaurants);
-    })
-    .catch(err => console.error('Ошибка при получении ресторанов:', err));
+    });
 
   function render(arr) {
     list.innerHTML = '';
@@ -35,6 +35,13 @@ document.addEventListener('DOMContentLoaded', () => {
       list.appendChild(col);
     });
 
+    document.querySelectorAll('.btn-more').forEach(btn => {
+      btn.addEventListener('click', e => {
+        const id = e.currentTarget.dataset.id;
+        window.location.href = `restaurant.html?id=${id}`;
+      });
+    });
+
     document.querySelectorAll('.btn-book').forEach(btn => {
       btn.addEventListener('click', e => {
         const id = e.currentTarget.dataset.id;
@@ -47,53 +54,44 @@ document.addEventListener('DOMContentLoaded', () => {
         bookingModal.show();
       });
     });
-
-    document.querySelectorAll('.btn-more').forEach(btn => {
-      btn.addEventListener('click', e => {
-        const id = e.currentTarget.dataset.id;
-        window.location.href = `restaurant.html?id=${id}`;
-      });
-    });
   }
 
-  // Фильтры
-  document.getElementById('applyFilters').addEventListener('click', () => {
-    const cuisine = document.getElementById('filterCuisine').value.trim();
-    const location = document.getElementById('filterLocation').value.trim().toLowerCase();
-    const price = document.getElementById('filterPrice').value;
-
-    let filtered = currentRestaurants;
-    if (cuisine !== "") filtered = filtered.filter(r => r.cuisine === cuisine);
-    if (location !== "") filtered = filtered.filter(r => r.location.toLowerCase().includes(location));
-    if (price !== "") filtered = filtered.filter(r => r.price <= Number(price));
-
-    render(filtered);
-  });
-
-  // Бронирование через API
-  bookingForm.addEventListener('submit', e => {
+  // ---------------- Отправка бронирования ----------------
+  bookingForm.addEventListener('submit', async e => {
     e.preventDefault();
     const currentUser = JSON.parse(localStorage.getItem('currentUser'));
-    if (!currentUser) { alert('Сначала войдите в аккаунт'); return; }
+    if (!currentUser) return alert('Сначала войдите в аккаунт');
 
     const booking = {
       email: currentUser.email,
-      id: document.getElementById('restaurantId').value,
+      restaurantId: document.getElementById('restaurantId').value,
       name: bookingTitle.textContent.replace('Бронирование: ', ''),
       date: document.getElementById('bookingDate').value,
-      guests: document.getElementById('guestsCount').value
+      guests: Number(document.getElementById('guestsCount').value)
     };
 
-    fetch('http://localhost:3000/bookings', {
+    await fetch('http://localhost:3000/bookings', {
       method: 'POST',
-      headers: { 'Content-Type': 'application/json' },
+      headers: {'Content-Type': 'application/json'},
       body: JSON.stringify(booking)
-    })
-    .then(res => res.json())
-    .then(data => {
-      alert('Бронирование сохранено на сервере!');
-      bookingModal.hide();
-    })
-    .catch(err => console.error('Ошибка при сохранении бронирования:', err));
+    });
+
+    alert('Бронирование сохранено на сервере!');
+    bookingModal.hide();
+  });
+
+  // ---------------- Фильтры ----------------
+  document.getElementById('applyFilters').addEventListener('click', () => {
+    const cuisine = document.getElementById('filterCuisine').value.trim();
+    const location = document.getElementById('filterLocation').value.trim().toLowerCase();
+    const price = document.getElementById('filterPrice').value;
+
+    let filtered = currentRestaurants;
+    if (cuisine) filtered = filtered.filter(r => r.cuisine === cuisine);
+    if (location) filtered = filtered.filter(r => r.location.toLowerCase().includes(location));
+    if (price) filtered = filtered.filter(r => r.price <= Number(price));
+
+    render(filtered);
   });
 });
+
-- 
2.42.0.windows.2

