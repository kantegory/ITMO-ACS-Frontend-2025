<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Fitness Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<div class="container mt-5">
    <div class="mb-3">
        <a href="../index.html" class="btn btn-back light-blue-text">‚Üê Back to Home</a>
    </div>
    
    <div class="row">
        <!-- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="col-md-4">
            <div class="card glass-card mb-4">
                <div class="card-body text-center">
                    <div class="user-avatar mb-3">
                        <div class="avatar-placeholder">
                            <span style="font-size: 3rem;">üë§</span>
                        </div>
                    </div>
                    <h3 class="light-blue-text" id="userName">Atanova Sophie</h3>
                    <p class="text-muted" id="userRole">Fitness Enthusiast</p>
                    <div class="user-stats">
                        <div class="row text-center">
                            <div class="col-4">
                                <h5 class="light-blue-text" id="workoutsCount">0</h5>
                                <small class="text-muted">Workouts</small>
                            </div>
                            <div class="col-4">
                                <h5 class="light-blue-text" id="weeksCount">8</h5>
                                <small class="text-muted">Weeks</small>
                            </div>
                            <div class="col-4">
                                <h5 class="light-blue-text" id="consistencyRate">0%</h5>
                                <small class="text-muted">Consistency</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ -->
            <div class="card glass-card">
                <div class="card-body">
                    <h5 class="light-blue-text mb-3">Completed Workouts</h5>
                    <div id="completedWorkoutsList">
                        <!-- –°–ø–∏—Å–æ–∫ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω —á–µ—Ä–µ–∑ JavaScript -->
                        <div class="text-center py-3">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading completed workouts...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –∏ –ø–ª–∞–Ω—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ -->
        <div class="col-md-8">
            <div class="card glass-card mb-4">
                <div class="card-body">
                    <h4 class="light-blue-text mb-4">Progress Tracking</h4>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="progress-item">
                                <h6>Workouts Completed</h6>
                                <div class="progress mb-2">
                                    <div id="workoutsProgressBar" class="progress-bar" style="width: 0%">0/10</div>
                                </div>
                                <small id="workoutsProgressText" class="text-muted">0 workouts completed</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="progress-item">
                                <h6>Calories Burned</h6>
                                <div class="progress mb-2">
                                    <div id="caloriesProgressBar" class="progress-bar bg-success" style="width: 0%">0/7,500</div>
                                </div>
                                <small id="caloriesProgressText" class="text-muted">0 calories burned</small>
                            </div>
                        </div>
                    </div>

                    <!-- –¢–µ–∫—É—â–∏–π –ø–ª–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ -->
                    <h5 class="light-blue-text mb-3">Current Workout Plan</h5>
                    <div class="workout-plan">
                        <div class="plan-item card mb-2">
                            <div class="card-body py-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>Monday</strong> - Strength Training
                                    </div>
                                    <span id="mondayStatus" class="badge bg-success">Completed</span>
                                </div>
                            </div>
                        </div>
                        <div class="plan-item card mb-2">
                            <div class="card-body py-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>Wednesday</strong> - Cardio
                                    </div>
                                    <span id="wednesdayStatus" class="badge bg-warning">Pending</span>
                                </div>
                            </div>
                        </div>
                        <div class="plan-item card mb-2">
                            <div class="card-body py-2">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>Friday</strong> - Yoga & Stretching
                                    </div>
                                    <span id="fridayStatus" class="badge bg-secondary">Upcoming</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
                    <h5 class="light-blue-text mt-4 mb-3">Achievements</h5>
                    <div class="achievements">
                        <div class="row">
                            <div class="col-4 text-center">
                                <div class="achievement-item">
                                    <span style="font-size: 2rem;"></span>
                                    <small class="d-block">First 5K</small>
                                </div>
                            </div>
                            <div class="col-4 text-center">
                                <div class="achievement-item">
                                    <span style="font-size: 2rem;"></span>
                                    <small class="d-block">Strength Master</small>
                                </div>
                            </div>
                            <div class="col-4 text-center">
                                <div class="achievement-item">
                                    <span style="font-size: 2rem;"></span>
                                    <small class="d-block" id="workoutAchievement">0 Workouts</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.progress {
    height: 8px;
    background-color: #e9ecef;
}

.progress-bar {
    background-color: var(--primary-blue);
}

.achievement-item {
    padding: 10px;
    border-radius: 10px;
    background: rgba(79, 134, 247, 0.1);
}

.plan-item {
    border-left: 4px solid var(--primary-blue);
}

.completed-workout-item {
    background: rgba(79, 134, 247, 0.05);
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 8px;
    border-left: 3px solid var(--primary-blue);
}

.completed-workout-item h6 {
    margin-bottom: 3px;
    font-size: 0.95rem;
}

.completed-workout-item small {
    color: #6c757d;
    font-size: 0.8rem;
}

.level-badge {
    padding: 2px 6px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 500;
}

.level-beginner {
    background: #10b981;
    color: white;
}

.level-intermediate {
    background: #f59e0b;
    color: white;
}

.level-advanced {
    background: #ef4444;
    color: white;
}

#emptyCompletedWorkouts {
    text-align: center;
    padding: 20px;
    color: #6c757d;
}

#emptyCompletedWorkouts i {
    font-size: 2rem;
    margin-bottom: 10px;
    color: #dee2e6;
}
</style>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
const AppState = {
    currentUser: JSON.parse(localStorage.getItem('current_user')) || null,
    completedWorkouts: JSON.parse(localStorage.getItem('completedWorkouts')) || []
};

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è
function loadProfileData() {
    console.log('Loading profile data...');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    updateUserInfo();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
    loadCompletedWorkouts();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    updateProgressStats();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
function updateUserInfo() {
    const userName = document.getElementById('userName');
    const userRole = document.getElementById('userRole');
    
    if (AppState.currentUser) {
        userName.textContent = `${AppState.currentUser.firstName || 'Atanova'} ${AppState.currentUser.lastName || 'Sophie'}`;
        userRole.textContent = AppState.currentUser.role || 'Fitness Enthusiast';
    } else {
        userName.textContent = 'Atanova Sophie';
        userRole.textContent = 'Fitness Enthusiast';
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
function loadCompletedWorkouts() {
    const container = document.getElementById('completedWorkoutsList');
    
    if (!AppState.completedWorkouts || AppState.completedWorkouts.length === 0) {
        container.innerHTML = `
            <div id="emptyCompletedWorkouts">
                <i class="fas fa-dumbbell"></i>
                <p>No workouts completed yet</p>
                <p class="small text-muted">Complete workouts to see them here!</p>
                <a href="workouts.html" class="btn btn-sm btn-form-primary">
                    <i class="fas fa-dumbbell me-1"></i>Browse Workouts
                </a>
            </div>
        `;
        return;
    }
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
    const sortedWorkouts = [...AppState.completedWorkouts].sort((a, b) => {
        return new Date(b.date || b.completedDate) - new Date(a.date || a.completedDate);
    });
    
    let html = '';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
    const recentWorkouts = sortedWorkouts.slice(0, 5);
    
    recentWorkouts.forEach((workout, index) => {
        const date = new Date(workout.date || workout.completedDate);
        const formattedDate = date.toLocaleDateString('en-US', {
            month: 'short',
            day: 'numeric'
        });
        const formattedTime = date.toLocaleTimeString('en-US', {
            hour: '2-digit',
            minute: '2-digit'
        });
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        let levelClass = 'level-beginner';
        let levelText = 'Beginner';
        
        if (workout.level === 'intermediate') {
            levelClass = 'level-intermediate';
            levelText = 'Intermediate';
        } else if (workout.level === 'advanced') {
            levelClass = 'level-advanced';
            levelText = 'Advanced';
        }
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–∫–æ–Ω–∫—É –ø–æ —Ç–∏–ø—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        let workoutIcon = 'fa-dumbbell';
        if (workout.type === 'cardio') workoutIcon = 'fa-running';
        else if (workout.type === 'yoga') workoutIcon = 'fa-spa';
        else if (workout.type === 'stretching') workoutIcon = 'fa-child';
        else if (workout.type === 'hiit') workoutIcon = 'fa-bolt';
        
        html += `
            <div class="completed-workout-item">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="mb-1">
                            <i class="fas ${workoutIcon} me-1"></i>
                            ${workout.name || `Workout ${index + 1}`}
                        </h6>
                        <div class="d-flex align-items-center">
                            <span class="${levelClass} level-badge me-2">${levelText}</span>
                            <small class="text-muted">
                                <i class="far fa-calendar me-1"></i>${formattedDate} at ${formattedTime}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å –±–æ–ª—å—à–µ 5 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    if (sortedWorkouts.length > 5) {
        html += `
            <div class="text-center mt-3">
                <small class="text-muted">
                    +${sortedWorkouts.length - 5} more workouts
                </small>
            </div>
        `;
    }
    
    container.innerHTML = html;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
function updateProgressStats() {
    const completedCount = AppState.completedWorkouts.length;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
    document.getElementById('workoutsCount').textContent = completedCount;
    document.getElementById('consistencyRate').textContent = calculateConsistencyRate(completedCount);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫
    const workoutsGoal = 10;
    const workoutsProgress = Math.min(100, Math.round((completedCount / workoutsGoal) * 100));
    const workoutsProgressBar = document.getElementById('workoutsProgressBar');
    const workoutsProgressText = document.getElementById('workoutsProgressText');
    
    workoutsProgressBar.style.width = `${workoutsProgress}%`;
    workoutsProgressBar.textContent = `${completedCount}/${workoutsGoal}`;
    workoutsProgressText.textContent = `${completedCount} workouts completed`;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∫–∞–ª–æ—Ä–∏–π
    const totalCalories = calculateTotalCalories();
    const caloriesGoal = 7500;
    const caloriesProgress = Math.min(100, Math.round((totalCalories / caloriesGoal) * 100));
    const caloriesProgressBar = document.getElementById('caloriesProgressBar');
    const caloriesProgressText = document.getElementById('caloriesProgressText');
    
    caloriesProgressBar.style.width = `${caloriesProgress}%`;
    caloriesProgressBar.textContent = `${totalCalories.toLocaleString()}/7,500`;
    caloriesProgressText.textContent = `${totalCalories.toLocaleString()} calories burned`;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
    document.getElementById('workoutAchievement').textContent = `${completedCount} Workouts`;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
    updateWorkoutPlanStatus();
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function calculateTotalCalories() {
    let total = 0;
    
    AppState.completedWorkouts.forEach(workout => {
        // –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–∞–ª–æ—Ä–∏–∏ –∏–∑ —Å—Ç—Ä–æ–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "300-400")
        const caloriesText = workout.calories || '300-400';
        
        if (caloriesText.includes('-')) {
            const parts = caloriesText.split('-').map(part => parseInt(part.trim()) || 0);
            const average = parts.length > 0 ? parts.reduce((a, b) => a + b, 0) / parts.length : 350;
            total += average;
        } else {
            total += parseInt(caloriesText) || 350;
        }
    });
    
    return Math.round(total);
}

function calculateConsistencyRate(completedWorkouts) {
    // –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ü–∏–∏
    if (completedWorkouts >= 15) return '95%';
    if (completedWorkouts >= 10) return '85%';
    if (completedWorkouts >= 5) return '70%';
    if (completedWorkouts >= 1) return '50%';
    return '0%';
}

function updateWorkoutPlanStatus() {
    const today = new Date();
    const dayOfWeek = today.getDay(); // 0 = Sunday, 1 = Monday, etc.
    
    const mondayStatus = document.getElementById('mondayStatus');
    const wednesdayStatus = document.getElementById('wednesdayStatus');
    const fridayStatus = document.getElementById('fridayStatus');
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–Ω—è –Ω–µ–¥–µ–ª–∏
    if (dayOfWeek === 1) { // Monday
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏
        const hasWorkoutToday = checkIfWorkoutCompletedToday('strength');
        mondayStatus.className = hasWorkoutToday ? 'badge bg-success' : 'badge bg-warning';
        mondayStatus.textContent = hasWorkoutToday ? 'Completed' : 'Today';
        
        wednesdayStatus.className = 'badge bg-secondary';
        wednesdayStatus.textContent = 'Upcoming';
        
        fridayStatus.className = 'badge bg-secondary';
        fridayStatus.textContent = 'Upcoming';
    } else if (dayOfWeek === 3) { // Wednesday
        mondayStatus.className = 'badge bg-success';
        mondayStatus.textContent = 'Completed';
        
        const hasWorkoutToday = checkIfWorkoutCompletedToday('cardio');
        wednesdayStatus.className = hasWorkoutToday ? 'badge bg-success' : 'badge bg-warning';
        wednesdayStatus.textContent = hasWorkoutToday ? 'Completed' : 'Today';
        
        fridayStatus.className = 'badge bg-secondary';
        fridayStatus.textContent = 'Upcoming';
    } else if (dayOfWeek === 5) { // Friday
        mondayStatus.className = 'badge bg-success';
        mondayStatus.textContent = 'Completed';
        
        wednesdayStatus.className = 'badge bg-success';
        wednesdayStatus.textContent = 'Completed';
        
        const hasWorkoutToday = checkIfWorkoutCompletedToday('yoga');
        fridayStatus.className = hasWorkoutToday ? 'badge bg-success' : 'badge bg-warning';
        fridayStatus.textContent = hasWorkoutToday ? 'Completed' : 'Today';
    } else {
        // –î–ª—è –¥—Ä—É–≥–∏—Ö –¥–Ω–µ–π
        mondayStatus.className = 'badge bg-success';
        mondayStatus.textContent = 'Completed';
        
        wednesdayStatus.className = 'badge bg-warning';
        wednesdayStatus.textContent = 'Pending';
        
        fridayStatus.className = 'badge bg-secondary';
        fridayStatus.textContent = 'Upcoming';
    }
}

function checkIfWorkoutCompletedToday(type) {
    const today = new Date();
    const todayString = today.toISOString().split('T')[0];
    
    return AppState.completedWorkouts.some(workout => {
        const workoutDate = new Date(workout.date || workout.completedDate);
        const workoutDateString = workoutDate.toISOString().split('T')[0];
        
        // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ (–º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å)
        if (type === 'strength') {
            return workoutDateString === todayString && 
                   (workout.type === 'strength' || workout.type === 'power-lifting');
        } else if (type === 'cardio') {
            return workoutDateString === todayString && 
                   (workout.type === 'cardio' || workout.type === 'hiit');
        } else if (type === 'yoga') {
            return workoutDateString === todayString && 
                   (workout.type === 'yoga' || workout.type === 'stretching');
        }
        return false;
    });
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log('Profile page loaded');
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª—è
    loadProfileData();
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    if (!AppState.currentUser) {
        console.log('User not logged in, showing guest profile');
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ö–æ–¥–∞
    }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (–º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∏–∑–≤–Ω–µ)
function refreshProfileData() {
    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
    AppState.completedWorkouts = JSON.parse(localStorage.getItem('completedWorkouts')) || [];
    AppState.currentUser = JSON.parse(localStorage.getItem('current_user')) || null;
    
    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    loadProfileData();
}
</script>

<script src="../script.js"></script>
</body>
</html>