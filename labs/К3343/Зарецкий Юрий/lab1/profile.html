<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - –ê—Ä–µ–Ω–¥–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">üè† –ê—Ä–µ–Ω–¥–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h1 class="mb-4">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
        
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h5 class="card-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h5>
                                <p class="mb-1"><strong>–ò–º—è:</strong> <span id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
                                <p class="mb-1"><strong>Email:</strong> <span id="userEmail">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
                                <p class="mb-0"><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> <span id="userPhone">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
                            </div>
                            <button class="btn btn-danger" onclick="logout()">–í—ã–π—Ç–∏</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12">
                <h2 class="mb-3">–ú–æ—è –∞—Ä–µ–Ω–¥—É—é—â–∞—è—Å—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</h2>
                <div class="row" id="rentingProperties">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <h2 class="mb-3">–ú–æ—è –∞—Ä–µ–Ω–¥–æ–≤–∞–Ω–Ω–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</h2>
                <div class="row" id="rentedProperties">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/main.js"></script>
    <script>
        // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ main.js
        if (typeof updateNavigation === 'function') {
            updateNavigation();
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        async function checkAuth() {
            await UserService.loadUsers();
            const currentUser = UserService.getCurrentUser();
            
            if (!currentUser) {
                alert('–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–∏—á–Ω–æ–º—É –∫–∞–±–∏–Ω–µ—Ç—É –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                window.location.href = 'login.html';
                return false;
            }
            
            return true;
        }

        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                UserService.logout();
                window.location.href = 'index.html';
            }
        }

        function renderPropertyCard(property, containerId) {
            const container = document.getElementById(containerId);
            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4 mb-4';
            const image = property.images && property.images.length > 0 
                ? property.images[0] 
                : "https://via.placeholder.com/300x200?text=–ù–µ—Ç+—Ñ–æ—Ç–æ";
            col.innerHTML = `
                <div class="card h-100">
                    <img src="${image}" class="card-img-top" alt="${property.title}" style="height: 200px; object-fit: cover;">
                    <div class="card-body">
                        <h5 class="card-title">${property.title}</h5>
                        <p class="card-text text-muted">${property.location}</p>
                        <p class="card-text"><strong>${property.price.toLocaleString()} ‚ÇΩ/–º–µ—Å</strong></p>
                        <p class="card-text"><span class="badge bg-success">–ê–∫—Ç–∏–≤–Ω–∞</span></p>
                        <a href="property.html?id=${property.id}" class="btn btn-primary btn-sm">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                    </div>
                </div>
            `;
            container.appendChild(col);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è
        async function loadProfile() {
            if (!await checkAuth()) {
                return;
            }

            const currentUser = UserService.getCurrentUser();
            
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            document.getElementById('userName').textContent = currentUser.fullName;
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userPhone').textContent = currentUser.phone;

            // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
            await ApartmentService.loadApartments();
            
            // –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–¥–∞–µ—Ç
            const rentingProperties = ApartmentService.getUserApartments(currentUser.id);
            const rentingContainer = document.getElementById('rentingProperties');
            rentingContainer.innerHTML = '';
            
            if (rentingProperties.length === 0) {
                rentingContainer.innerHTML = '<div class="col-12"><div class="alert alert-info">–£ –≤–∞—Å –Ω–µ—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –¥–ª—è —Å–¥–∞—á–∏</div></div>';
            } else {
                rentingProperties.forEach(prop => renderPropertyCard(prop, 'rentingProperties'));
            }

            // –ê—Ä–µ–Ω–¥–æ–≤–∞–Ω–Ω–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å
            const rentedData = ApartmentService.getRentedApartments(currentUser.id);
            const rentedContainer = document.getElementById('rentedProperties');
            rentedContainer.innerHTML = '';
            
            if (rentedData.length === 0) {
                rentedContainer.innerHTML = '<div class="col-12"><div class="alert alert-info">–í—ã –µ—â–µ –Ω–µ –∞—Ä–µ–Ω–¥–æ–≤–∞–ª–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</div></div>';
            } else {
                rentedData.forEach(rent => {
                    const apartment = ApartmentService.getApartmentById(rent.apartmentId);
                    if (apartment) {
                        const col = document.createElement('div');
                        col.className = 'col-md-6 col-lg-4 mb-4';
                        const image = apartment.images && apartment.images.length > 0 
                            ? apartment.images[0] 
                            : "https://via.placeholder.com/300x200?text=–ù–µ—Ç+—Ñ–æ—Ç–æ";
                        col.innerHTML = `
                            <div class="card h-100">
                                <img src="${image}" class="card-img-top" alt="${apartment.title}" style="height: 200px; object-fit: cover;">
                                <div class="card-body">
                                    <h5 class="card-title">${apartment.title}</h5>
                                    <p class="card-text text-muted">${apartment.location}</p>
                                    <p class="card-text"><strong>${apartment.price.toLocaleString()} ‚ÇΩ/–º–µ—Å</strong></p>
                                    <p class="card-text"><span class="badge bg-info">–ê—Ä–µ–Ω–¥–æ–≤–∞–Ω–∞</span></p>
                                    <p class="card-text small text-muted">–° ${rent.startDate} –ø–æ ${rent.endDate}</p>
                                    <a href="property.html?id=${apartment.id}" class="btn btn-primary btn-sm">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                                </div>
                            </div>
                        `;
                        rentedContainer.appendChild(col);
                    }
                });
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadProfile();
    </script>
</body>
</html>

