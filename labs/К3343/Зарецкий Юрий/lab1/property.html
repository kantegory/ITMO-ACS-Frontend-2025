<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–±—ä–µ–∫—Ç –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ - –ê—Ä–µ–Ω–¥–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">üè† –ê—Ä–µ–Ω–¥–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="mb-3">
            <a href="search.html" class="btn btn-outline-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ–∏—Å–∫—É</a>
        </div>

        <div class="row">
            <!-- –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
            <div class="col-md-8 mb-4">
                <div id="propertyCarousel" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner" id="carouselInner">
                        <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#propertyCarousel" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#propertyCarousel" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                    </button>
                </div>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title" id="propertyTitle">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
                        <p class="text-muted mb-3" id="propertyLocation">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                        <h3 class="text-primary mb-4" id="propertyPrice">–ó–∞–≥—Ä—É–∑–∫–∞...</h3>
                        <button class="btn btn-primary btn-lg w-100 mb-3" data-bs-toggle="modal" data-bs-target="#contactModal">
                            –°–≤—è–∑–∞—Ç—å—Å—è —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º
                        </button>
                        <button class="btn btn-outline-primary w-100" data-bs-toggle="modal" data-bs-target="#rentModal">
                            –ê—Ä–µ–Ω–¥–æ–≤–∞—Ç—å
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-body">
                        <h4 class="card-title">–û–ø–∏—Å–∞–Ω–∏–µ</h4>
                        <p class="card-text" id="propertyDescription">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-body">
                        <h4 class="card-title">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h4>
                        <ul class="list-unstyled" id="propertyFeatures">
                            <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">–£—Å–ª–æ–≤–∏—è –∞—Ä–µ–Ω–¥—ã</h4>
                        <ul id="rentalConditions">
                            <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–≤—è–∑–∏ -->
    <div class="modal fade" id="contactModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–°–≤—è–∑–∞—Ç—å—Å—è —Å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="contactForm">
                        <div class="mb-3">
                            <label for="contactName" class="form-label">–í–∞—à–µ –∏–º—è</label>
                            <input type="text" class="form-control" id="contactName" required>
                        </div>
                        <div class="mb-3">
                            <label for="contactPhone" class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                            <input type="tel" class="form-control" id="contactPhone" required>
                        </div>
                        <div class="mb-3">
                            <label for="contactMessage" class="form-label">–°–æ–æ–±—â–µ–Ω–∏–µ</label>
                            <textarea class="form-control" id="contactMessage" rows="3" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-primary" onclick="submitContact()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∞—Ä–µ–Ω–¥—ã -->
    <div class="modal fade" id="rentModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">–û—Ñ–æ—Ä–º–∏—Ç—å –∞—Ä–µ–Ω–¥—É</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="rentForm">
                        <div class="mb-3">
                            <label for="rentStartDate" class="form-label">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –∞—Ä–µ–Ω–¥—ã</label>
                            <input type="date" class="form-control" id="rentStartDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="rentEndDate" class="form-label">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞—Ä–µ–Ω–¥—ã</label>
                            <input type="date" class="form-control" id="rentEndDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="rentGuests" class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π</label>
                            <input type="number" class="form-control" id="rentGuests" min="1" required>
                        </div>
                        <div class="alert alert-info">
                            <strong>–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ:</strong> <span id="totalAmount">0</span> ‚ÇΩ
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-primary" onclick="submitRent()">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/main.js"></script>
    <script>
        // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏—é –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ main.js
        if (typeof updateNavigation === 'function') {
            updateNavigation();
        }
        
        let property = null;

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function loadProperty() {
            await ApartmentService.loadApartments();
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ ID –∏–∑ URL
            const urlParams = new URLSearchParams(window.location.search);
            const propertyId = parseInt(urlParams.get('id')) || 1;
            property = ApartmentService.getApartmentById(propertyId);
            
            if (!property) {
                // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –±–µ—Ä–µ–º –ø–µ—Ä–≤—É—é
                const apartments = ApartmentService.getApartments();
                property = apartments.length > 0 ? apartments[0] : null;
            }
            
            if (property) {
                renderProperty();
            }
        }

        function renderProperty() {
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≥–∞–ª–µ—Ä–µ–∏
        const carouselInner = document.getElementById('carouselInner');
        property.images.forEach((image, index) => {
            const item = document.createElement('div');
            item.className = `carousel-item ${index === 0 ? 'active' : ''}`;
            item.innerHTML = `<img src="${image}" class="d-block w-100" alt="–§–æ—Ç–æ ${index + 1}" style="height: 500px; object-fit: cover;">`;
            carouselInner.appendChild(item);
        });

        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        document.getElementById('propertyTitle').textContent = property.title;
        document.getElementById('propertyLocation').textContent = property.location;
        document.getElementById('propertyPrice').textContent = `${property.price.toLocaleString()} ‚ÇΩ/–º–µ—Å`;
        document.getElementById('propertyDescription').textContent = property.description;

        // –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
        const featuresList = document.getElementById('propertyFeatures');
        const typeNames = {
            apartment: '–ö–≤–∞—Ä—Ç–∏—Ä–∞',
            house: '–î–æ–º',
            office: '–û—Ñ–∏—Å',
            studio: '–°—Ç—É–¥–∏—è'
        };
        featuresList.innerHTML = `
            <li><strong>–¢–∏–ø:</strong> ${typeNames[property.type] || property.type}</li>
            <li><strong>–ö–æ–º–Ω–∞—Ç:</strong> ${property.rooms}</li>
            <li><strong>–ü–ª–æ—â–∞–¥—å:</strong> ${property.area} –º¬≤</li>
            <li><strong>–≠—Ç–∞–∂:</strong> ${property.floor} –∏–∑ ${property.totalFloors}</li>
        `;

        // –£—Å–ª–æ–≤–∏—è –∞—Ä–µ–Ω–¥—ã
        const conditionsList = document.getElementById('rentalConditions');
        property.conditions.forEach(condition => {
            const li = document.createElement('li');
            li.className = 'mb-2';
            li.textContent = condition;
            conditionsList.appendChild(li);
        });

        function submitContact() {
            const name = document.getElementById('contactName').value;
            const phone = document.getElementById('contactPhone').value;
            const message = document.getElementById('contactMessage').value;
            
            if (name && phone && message) {
                alert('–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –í–ª–∞–¥–µ–ª–µ—Ü —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.');
                const modal = bootstrap.Modal.getInstance(document.getElementById('contactModal'));
                modal.hide();
                document.getElementById('contactForm').reset();
            }
        }

        function submitRent() {
            const startDate = document.getElementById('rentStartDate').value;
            const endDate = document.getElementById('rentEndDate').value;
            const guests = document.getElementById('rentGuests').value;
            
            if (startDate && endDate && guests) {
                const currentUser = UserService.getCurrentUser();
                if (!currentUser) {
                    alert('–î–ª—è –∞—Ä–µ–Ω–¥—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                    window.location.href = 'login.html';
                    return;
                }
                
                ApartmentService.rentApartment(property.id, currentUser.id, {
                    startDate,
                    endDate,
                    guests: parseInt(guests)
                });
                
                alert('–ó–∞—è–≤–∫–∞ –Ω–∞ –∞—Ä–µ–Ω–¥—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞.');
                const modal = bootstrap.Modal.getInstance(document.getElementById('rentModal'));
                modal.hide();
                document.getElementById('rentForm').reset();
            }
        }

        // –†–∞—Å—á–µ—Ç —Å—É–º–º—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞—Ç
        document.getElementById('rentStartDate').addEventListener('change', calculateTotal);
        document.getElementById('rentEndDate').addEventListener('change', calculateTotal);

        function calculateTotal() {
            const startDate = new Date(document.getElementById('rentStartDate').value);
            const endDate = new Date(document.getElementById('rentEndDate').value);
            
            if (startDate && endDate && endDate > startDate) {
                const days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
                const months = Math.ceil(days / 30);
                const total = property.price * months;
                document.getElementById('totalAmount').textContent = total.toLocaleString();
            } else {
                document.getElementById('totalAmount').textContent = '0';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        loadProperty();
    </script>
</body>
</html>

