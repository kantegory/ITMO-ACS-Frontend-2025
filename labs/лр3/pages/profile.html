<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Your Fitness Platform Profile - Track your workouts, progress, and achievements">
    <title>Profile - Fitness Platform</title>
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Применяем тему СРАЗУ до рендеринга -->
    <script>
    (function() {
        var theme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', theme);
    })();
    </script>
    
    <style>
        /* Скрываем body до полной загрузки чтобы не было прыжков */
        body {
            opacity: 1;
        }
        
        .svg-icon {
            width: 1em;
            height: 1em;
            vertical-align: -0.125em;
            fill: currentColor;
        }
        
        .achievement-icon {
            width: 2.5rem;
            height: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .progress {
            height: 8px;
            background-color: #e9ecef;
        }

        .progress-bar {
            background-color: var(--primary-blue);
        }

        .achievement-item {
            padding: 15px;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(79, 134, 247, 0.1), rgba(56, 178, 172, 0.1));
            border: 2px solid rgba(79, 134, 247, 0.2);
            transition: all 0.3s ease;
            text-align: center;
        }

        .achievement-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(79, 134, 247, 0.15);
            border-color: var(--primary-blue);
        }

        .plan-item {
            border-left: 4px solid var(--primary-blue);
            transition: all 0.3s ease;
        }

        .plan-item:hover {
            transform: translateX(5px);
        }

        .plan-item.completed {
            border-left-color: #10b981;
            background: rgba(16, 185, 129, 0.05) !important;
        }

        .completed-workout-item {
            background: rgba(79, 134, 247, 0.05);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
            border-left: 3px solid var(--primary-blue);
        }

        .completed-workout-item h6 {
            margin-bottom: 3px;
            font-size: 0.95rem;
        }

        .completed-workout-item small {
            color: #5a6268;
            font-size: 0.8rem;
        }

        .level-badge {
            padding: 2px 6px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .level-beginner { background: #10b981; color: white; }
        .level-intermediate { background: #f59e0b; color: white; }
        .level-advanced { background: #ef4444; color: white; }

        #emptyCompletedWorkouts {
            text-align: center;
            padding: 20px;
            color: #5a6268;
        }

        .user-avatar .avatar-placeholder {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-teal));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
        
        .user-avatar .avatar-placeholder .avatar-icon {
            width: 60px;
            height: 60px;
        }
        
        .avatar-icon .avatar-path { fill: #4f86f7; }
        [data-theme="dark"] .avatar-icon .avatar-path { fill: #ffffff; }
        [data-theme="pink"] .avatar-icon .avatar-path { fill: #ec4899; }
        
        .user-stats .col-4 {
            border-right: 1px solid var(--border-light);
            padding-left: 5px;
            padding-right: 5px;
        }
        
        .user-stats .col-4:last-child { border-right: none; }
        .user-stats .h5 { font-size: 1rem; white-space: nowrap; }
        .user-stats small { font-size: 0.7rem; white-space: nowrap; }

        .day-header {
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        .day-section { margin-bottom: 1rem; }

        .workout-type-icon {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            margin-right: 10px;
        }

        .type-cardio { background: #fecaca; color: #dc2626; }
        .type-strength { background: #bfdbfe; color: #2563eb; }
        .type-yoga { background: #d9f99d; color: #65a30d; }
        .type-hiit { background: #fcd34d; color: #d97706; }
        .type-stretching { background: #c4b5fd; color: #7c3aed; }
        .type-power-lifting { background: #fda4af; color: #e11d48; }
        
        .stats-icon { color: var(--primary-blue); }
        
        [data-theme="dark"] .plan-item .workout-title { color: #1f2937 !important; }
        [data-theme="dark"] .plan-item .workout-info { color: #374151 !important; }

        /* Переключатель тем - фиксированная позиция */
        .theme-switcher {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(79, 134, 247, 0.2);
        }
        
        [data-theme="dark"] .theme-switcher {
            background: rgba(30, 41, 59, 0.95);
            border-color: rgba(79, 134, 247, 0.3);
        }
        
        [data-theme="pink"] .theme-switcher {
            background: rgba(255, 255, 255, 0.95);
            border-color: rgba(236, 72, 153, 0.3);
        }
        
        .theme-switcher .btn-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .theme-switcher .theme-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            border: 2px solid transparent;
            background: #f3f4f6;
            color: #6b7280;
            cursor: pointer;
        }
        
        [data-theme="dark"] .theme-switcher .theme-btn {
            background: #374151;
            color: #9ca3af;
        }
        
        .theme-switcher .theme-btn:hover {
            background: #e5e7eb;
            color: #4f86f7;
        }
        
        [data-theme="dark"] .theme-switcher .theme-btn:hover {
            background: #4b5563;
            color: #60a5fa;
        }
        
        .theme-switcher .theme-btn.active {
            background: linear-gradient(135deg, #4f86f7, #38b2ac);
            color: white;
            border-color: #4f86f7;
            box-shadow: 0 4px 12px rgba(79, 134, 247, 0.4);
        }
        
        .theme-switcher .theme-btn svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .spinner { animation: spin 1s linear infinite; }
    </style>
</head>
<body>
    <!-- Переключатель тем -->
    <div class="theme-switcher" role="group" aria-label="Theme switcher">
        <div class="btn-group" role="group">
            <button type="button" class="theme-btn" data-theme="light" aria-label="Light theme">
                <svg viewBox="0 0 24 24"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"/></svg>
            </button>
            <button type="button" class="theme-btn" data-theme="dark" aria-label="Dark theme">
                <svg viewBox="0 0 24 24"><path d="M9.37 5.51c-.18.64-.27 1.31-.27 1.99 0 4.08 3.32 7.4 7.4 7.4.68 0 1.35-.09 1.99-.27C17.45 17.19 14.93 19 12 19c-3.86 0-7-3.14-7-7 0-2.93 1.81-5.45 4.37-6.49zM12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>
            </button>
            <button type="button" class="theme-btn" data-theme="pink" aria-label="Pink theme">
                <svg viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
            </button>
        </div>
    </div>

    <div class="container mt-5">
        <div class="mb-3">
            <a href="../index.html" class="btn btn-back" aria-label="Go back to home page">
                <svg class="svg-icon me-1" style="width: 16px; height: 16px;"><use href="#icon-arrow-left"></use></svg>
                Back to Home
            </a>
        </div>

        <main id="main-content" role="main">
            <header class="mb-4">
                <h1 class="form-title">Your Profile</h1>
                <p class="text-muted">Track your fitness progress, completed workouts, and achievements</p>
            </header>
            
            <div class="row">
                <div class="col-md-4">
                    <section aria-labelledby="user-info-heading">
                        <div class="card glass-card mb-4">
                            <div class="card-body text-center">
                                <div class="user-avatar mb-3">
                                    <div class="avatar-placeholder">
                                        <svg class="avatar-icon" viewBox="0 0 24 24">
                                            <path class="avatar-path" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                        </svg>
                                    </div>
                                </div>
                                <h2 id="user-info-heading" class="light-blue-text">Atanova Sophie</h2>
                                <p class="text-muted">Fitness Enthusiast</p>
                                <div class="user-stats">
                                    <div class="row text-center">
                                        <div class="col-4">
                                            <div class="h5 light-blue-text stats-icon" id="workoutsCount">
                                                <svg class="svg-icon me-1" style="width: 16px; height: 16px;"><use href="#icon-dumbbell"></use></svg>0
                                            </div>
                                            <small class="text-muted">Workouts</small>
                                        </div>
                                        <div class="col-4">
                                            <div class="h5 light-blue-text stats-icon" id="weeksCount">
                                                <svg class="svg-icon me-1" style="width: 16px; height: 16px;"><use href="#icon-calendar"></use></svg>8
                                            </div>
                                            <small class="text-muted">Weeks</small>
                                        </div>
                                        <div class="col-4">
                                            <div class="h5 light-blue-text stats-icon" id="consistencyRate">
                                                <svg class="svg-icon me-1" style="width: 16px; height: 16px;"><use href="#icon-chart"></use></svg>0%
                                            </div>
                                            <small class="text-muted">Consistency</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <section aria-labelledby="completed-workouts-heading">
                        <div class="card glass-card">
                            <div class="card-body">
                                <h3 id="completed-workouts-heading" class="light-blue-text mb-3">
                                    <svg class="svg-icon me-2"><use href="#icon-check"></use></svg>Completed Workouts
                                </h3>
                                <div id="completedWorkoutsList">
                                    <div id="emptyCompletedWorkouts">
                                        <svg class="svg-icon mb-3" style="width: 3rem; height: 3rem; color: #dee2e6;"><use href="#icon-dumbbell"></use></svg>
                                        <p class="text-muted">No completed workouts yet.</p>
                                        <a href="workouts.html" class="btn btn-sm btn-form-primary">
                                            <svg class="svg-icon me-1"><use href="#icon-plus"></use></svg>Browse Workouts
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>

                <div class="col-md-8">
                    <section aria-labelledby="progress-heading">
                        <div class="card glass-card mb-4">
                            <div class="card-body">
                                <h2 id="progress-heading" class="light-blue-text mb-4">
                                    <svg class="svg-icon me-2"><use href="#icon-chart"></use></svg>Progress Tracking
                                </h2>
                                
                                <div class="row mb-4">
                                    <div class="col-md-6">
                                        <h3 class="h6"><svg class="svg-icon me-1"><use href="#icon-dumbbell"></use></svg>Workouts Completed</h3>
                                        <div class="progress mb-2"><div id="workoutsProgressBar" class="progress-bar" style="width: 0%">0/10</div></div>
                                        <small id="workoutsProgressText" class="text-muted">
                                            <svg class="svg-icon me-1" style="width: 12px; height: 12px;"><use href="#icon-clock"></use></svg>0 workouts completed
                                        </small>
                                    </div>
                                    <div class="col-md-6">
                                        <h3 class="h6"><svg class="svg-icon me-1"><use href="#icon-flame"></use></svg>Calories Burned</h3>
                                        <div class="progress mb-2"><div id="caloriesProgressBar" class="progress-bar bg-success" style="width: 0%">0/7500</div></div>
                                        <small class="text-muted">
                                            <svg class="svg-icon me-1" style="width: 12px; height: 12px;"><use href="#icon-target"></use></svg>Weekly goal: 7500 calories
                                        </small>
                                    </div>
                                </div>

                                <h3 class="h6 mb-3"><svg class="svg-icon me-1"><use href="#icon-trophy"></use></svg>Recent Achievements</h3>
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <div class="achievement-item">
                                            <svg class="svg-icon achievement-icon" style="color: #10b981;"><use href="#icon-trophy"></use></svg>
                                            <small class="text-muted d-block">First Workout</small>
                                            <small class="text-muted">Complete your first workout</small>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="achievement-item">
                                            <svg class="svg-icon achievement-icon" style="color: #f59e0b;"><use href="#icon-flame"></use></svg>
                                            <small class="text-muted d-block">5 Workouts</small>
                                            <small class="text-muted">Complete 5 workouts</small>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="achievement-item">
                                            <svg class="svg-icon achievement-icon" style="color: #ef4444;"><use href="#icon-star"></use></svg>
                                            <small class="text-muted d-block">Week Streak</small>
                                            <small class="text-muted">7 days in a row</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <section aria-labelledby="plan-heading">
                        <div class="card glass-card">
                            <div class="card-body">
                                <h2 id="plan-heading" class="light-blue-text mb-4">
                                    <svg class="svg-icon me-2"><use href="#icon-calendar"></use></svg>Weekly Plan
                                </h2>
                                <div id="weeklyPlanContainer">
                                    <div class="text-center py-3">
                                        <svg class="svg-icon spinner" style="width: 40px; height: 40px; color: var(--primary-blue);"><use href="#icon-loading"></use></svg>
                                    </div>
                                </div>
                                <div class="text-center mt-4">
                                    <a href="workouts.html" class="btn btn-form-primary">
                                        <svg class="svg-icon me-2"><use href="#icon-dumbbell"></use></svg>Browse All Workouts
                                    </a>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </main>
    </div>

    <!-- SVG спрайт -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="icon-trophy" viewBox="0 0 24 24"><path d="M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2zM5 8V7h2v3.82C5.84 10.4 5 9.3 5 8zm14 0c0 1.3-.84 2.4-2 2.82V7h2v1z" fill="currentColor"/></symbol>
        <symbol id="icon-flame" viewBox="0 0 24 24"><path d="M17.66 11.2c-.23-.3-.51-.56-.77-.82-.67-.6-1.43-1.03-2.07-1.66C13.33 7.26 13 4.85 13.95 3c-.95.23-1.78.75-2.49 1.32-2.59 2.08-3.61 5.75-2.39 8.9.04.1.08.2.08.33 0 .22-.15.42-.35.5-.23.1-.47.04-.66-.12a2.48 2.48 0 01-1.1-2.16c0-.92.52-1.73 1.26-2.15-.23-.59-.35-1.25-.35-1.9 0-2.16 1.73-3.92 3.86-3.92 2.13 0 3.86 1.76 3.86 3.92 0 .65-.12 1.31-.35 1.9.74.42 1.26 1.23 1.26 2.15 0 .89-.52 1.67-1.1 2.16-.19.16-.43.22-.66.12-.2-.08-.35-.28-.35-.5 0-.13.04-.23.08-.33.48-1.24.45-2.56-.01-3.81z" fill="currentColor"/></symbol>
        <symbol id="icon-heart" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" fill="currentColor"/></symbol>
        <symbol id="icon-chart" viewBox="0 0 24 24"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z" fill="currentColor"/><path d="M21 18v2H3v-2h18z" fill="currentColor"/></symbol>
        <symbol id="icon-star" viewBox="0 0 24 24"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" fill="currentColor"/></symbol>
        <symbol id="icon-clock" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/><path d="M12 6v6l4 2" stroke="currentColor" stroke-width="1.5" fill="none" stroke-linecap="round"/></symbol>
        <symbol id="icon-dumbbell" viewBox="0 0 24 24"><path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z" fill="currentColor"/></symbol>
        <symbol id="icon-calendar" viewBox="0 0 24 24"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zM9 14H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2zm-8 4H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2z" fill="currentColor"/></symbol>
        <symbol id="icon-check" viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor"/></symbol>
        <symbol id="icon-plus" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="currentColor"/></symbol>
        <symbol id="icon-target" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z" fill="currentColor"/><circle cx="12" cy="12" r="3" fill="currentColor"/></symbol>
        <symbol id="icon-arrow-left" viewBox="0 0 24 24"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" fill="currentColor"/></symbol>
        <symbol id="icon-loading" viewBox="0 0 24 24"><path d="M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z" fill="currentColor"/></symbol>
        <symbol id="icon-play" viewBox="0 0 24 24"><path d="M8 5v14l11-7z" fill="currentColor"/></symbol>
        <symbol id="icon-bed" viewBox="0 0 24 24"><path d="M21 10.78V8c0-1.65-1.35-3-3-3h-4c-.77 0-1.47.3-2 .78-.53-.48-1.23-.78-2-.78H6C4.35 5 3 6.35 3 8v2.78c-.61.55-1 1.34-1 2.22v6h2v-2h16v2h2v-6c0-.88-.39-1.67-1-2.22zM14 7h4c.55 0 1 .45 1 1v2h-6V8c0-.55.45-1 1-1zM5 8c0-.55.45-1 1-1h4c.55 0 1 .45 1 1v2H5V8z" fill="currentColor"/></symbol>
        <symbol id="icon-lotus" viewBox="0 0 24 24"><path d="M17 12c0 2.76-2.24 5-5 5s-5-2.24-5-5 2.24-5 5-5 5 2.24 5 5z" fill="currentColor"/></symbol>
        <symbol id="icon-stretch" viewBox="0 0 24 24"><path d="M4 20h16v2H4zM4 2h16v2H4zM12 5c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3m0-3c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6z" fill="currentColor"/></symbol>
        <symbol id="icon-weight" viewBox="0 0 24 24"><path d="M12 3C10.34 3 9 4.34 9 6c0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3zm0 14c-4.42 0-8-1.79-8-4v2c0 2.21 3.58 4 8 4s8-1.79 8-4v-2c0 2.21-3.58 4-8 4z" fill="currentColor"/></symbol>
    </svg>

    <script>var API_URL = 'http://localhost:3000/api';</script>
    <script src="../script.js"></script>
    <script>
    (function() {
        'use strict';
        
        var DAYS = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        var WEEKLY_PLAN = {
            1: { workoutId: 1, time: '07:00 AM' },
            2: { workoutId: 2, time: '06:00 PM' },
            3: { workoutId: 3, time: '07:30 AM' },
            4: { workoutId: 5, time: '06:00 PM' },
            5: { workoutId: 4, time: '07:00 AM' },
            6: { workoutId: 6, time: '10:00 AM' },
            0: null
        };
        var CUSTOM_TYPE_ICONS = {
            'cardio': 'icon-heart', 'strength': 'icon-dumbbell', 'yoga': 'icon-lotus',
            'hiit': 'icon-flame', 'stretching': 'icon-stretch', 'power-lifting': 'icon-weight', 'default': 'icon-dumbbell'
        };
        var CALORIES_BY_TYPE = {
            'cardio': 350, 'strength': 450, 'yoga': 250, 'stretching': 175, 'hiit': 425, 'power-lifting': 550, 'default': 300
        };
        
        var allWorkouts = [];
        var completedWorkouts = [];
        
        // Инициализация темы СРАЗУ (синхронно)
        (function initThemeInstant() {
            var theme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', theme);
            
            // Обновляем кнопки сразу
            document.querySelectorAll('.theme-btn').forEach(function(btn) {
                var btnTheme = btn.getAttribute('data-theme');
                if (btnTheme === theme) {
                    btn.classList.add('active');
                    btn.setAttribute('aria-pressed', 'true');
                } else {
                    btn.classList.remove('active');
                    btn.setAttribute('aria-pressed', 'false');
                }
            });
        })();
        
        document.addEventListener('DOMContentLoaded', function() {
            initThemeListeners();
            loadProfileData();
        });
        
        function initThemeListeners() {
            document.querySelectorAll('.theme-btn').forEach(function(btn) {
                btn.addEventListener('click', function() {
                    var theme = this.getAttribute('data-theme');
                    document.body.setAttribute('data-theme', theme);
                    document.documentElement.setAttribute('data-theme', theme);
                    localStorage.setItem('theme', theme);
                    
                    document.querySelectorAll('.theme-btn').forEach(function(b) {
                        var t = b.getAttribute('data-theme');
                        if (t === theme) {
                            b.classList.add('active');
                            b.setAttribute('aria-pressed', 'true');
                        } else {
                            b.classList.remove('active');
                            b.setAttribute('aria-pressed', 'false');
                        }
                    });
                });
            });
        }
        
        async function loadProfileData() {
            try {
                var response = await fetch(API_URL + '/workouts');
                if (response.ok) allWorkouts = await response.json();
                completedWorkouts = JSON.parse(localStorage.getItem('completedWorkouts')) || [];
                updateStats();
                renderWeeklyPlan();
                renderCompletedWorkouts();
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('weeklyPlanContainer').innerHTML = '<div class="alert alert-warning">Could not load data.</div>';
            }
        }
        
        function updateStats() {
            var count = completedWorkouts.length;
            var goal = 10;
            var percentage = Math.min(100, Math.round((count / goal) * 100));
            
            var el = document.getElementById('workoutsCount');
            if (el) el.innerHTML = '<svg class="svg-icon me-1" style="width:16px;height:16px"><use href="#icon-dumbbell"></use></svg>' + count;
            
            var bar = document.getElementById('workoutsProgressBar');
            if (bar) { bar.style.width = percentage + '%'; bar.textContent = count + '/' + goal; }
            
            var text = document.getElementById('workoutsProgressText');
            if (text) text.innerHTML = '<svg class="svg-icon me-1" style="width:12px;height:12px"><use href="#icon-clock"></use></svg>' + count + ' workouts completed';
            
            var totalCal = calculateTotalCalories();
            var calPct = Math.min(100, Math.round((totalCal / 7500) * 100));
            
            var calBar = document.getElementById('caloriesProgressBar');
            if (calBar) { calBar.style.width = calPct + '%'; calBar.textContent = totalCal + '/7500'; }
            
            var cons = document.getElementById('consistencyRate');
            if (cons) cons.innerHTML = '<svg class="svg-icon me-1" style="width:16px;height:16px"><use href="#icon-chart"></use></svg>' + percentage + '%';
        }
        
        function calculateTotalCalories() {
            var total = 0;
            completedWorkouts.forEach(function(w) {
                if (w.calories) { total += parseInt(w.calories) || 0; }
                else {
                    var type = w.type ? w.type.toLowerCase() : 'default';
                    var base = allWorkouts.find(function(x) { return x.id == w.id; });
                    if (base && base.type) type = base.type.toLowerCase();
                    var cal = CALORIES_BY_TYPE[type] || CALORIES_BY_TYPE['default'];
                    total += cal; w.calories = cal;
                }
            });
            localStorage.setItem('completedWorkouts', JSON.stringify(completedWorkouts));
            return total;
        }
        
        function renderWeeklyPlan() {
            var container = document.getElementById('weeklyPlanContainer');
            if (!container) return;
            
            var today = new Date();
            var currentDay = today.getDay();
            var html = '';
            
            for (var i = 0; i < 7; i++) {
                var dayIndex = (currentDay + i) % 7;
                var date = new Date(today);
                date.setDate(today.getDate() + i);
                
                var plan = WEEKLY_PLAN[dayIndex];
                var dayLabel = i === 0 ? 'Today' : (i === 1 ? 'Tomorrow' : DAYS[dayIndex]);
                var dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                html += '<div class="day-section"><div class="day-header"><svg class="svg-icon me-1" style="width:16px;height:16px"><use href="#icon-calendar"></use></svg>' + dayLabel + ' <small class="text-muted">(' + dateStr + ')</small></div>';
                
                if (plan) {
                    var workout = allWorkouts.find(function(w) { return w.id == plan.workoutId; });
                    if (workout) {
                        var isCompleted = isWorkoutCompletedOnDate(workout.id, date);
                        var typeClass = 'type-' + (workout.type || 'default').toLowerCase().replace(' ', '-');
                        var iconId = CUSTOM_TYPE_ICONS[workout.type] || CUSTOM_TYPE_ICONS['default'];
                        var calories = workout.calories || CALORIES_BY_TYPE[workout.type?.toLowerCase()] || CALORIES_BY_TYPE['default'];
                        
                        html += '<div class="plan-item p-3 bg-light rounded ' + (isCompleted ? 'completed' : '') + '"><div class="d-flex justify-content-between align-items-center"><div class="d-flex align-items-center"><div class="workout-type-icon ' + typeClass + '"><svg class="svg-icon" style="width:20px;height:20px"><use href="#' + iconId + '"></use></svg></div><div><h4 class="h6 mb-1 workout-title" style="color:#1f2937">' + workout.name + '</h4><span class="workout-info" style="color:#374151;font-size:0.85rem"><svg class="svg-icon me-1" style="width:12px;height:12px"><use href="#icon-clock"></use></svg>' + plan.time + ' • ' + (workout.duration === 'short' ? '20 min' : workout.duration === 'long' ? '45 min' : '30 min') + ' • <svg class="svg-icon me-1" style="width:12px;height:12px"><use href="#icon-flame"></use></svg>' + calories + ' cal</span></div></div>';
                        
                        if (isCompleted) html += '<span class="badge bg-success"><svg class="svg-icon me-1" style="width:12px;height:12px"><use href="#icon-check"></use></svg>Done</span>';
                        else html += '<a href="workout-details.html?id=' + workout.id + '" class="btn btn-sm btn-outline-primary"><svg class="svg-icon me-1" style="width:12px;height:12px"><use href="#icon-play"></use></svg>Start</a>';
                        
                        html += '</div></div>';
                    }
                } else {
                    html += '<div class="plan-item p-3 bg-light rounded"><div class="d-flex align-items-center"><div class="workout-type-icon" style="background:#e5e7eb;color:#6b7280"><svg class="svg-icon" style="width:20px;height:20px"><use href="#icon-bed"></use></svg></div><div><h4 class="h6 mb-1 workout-title" style="color:#6b7280">Rest Day</h4><span class="workout-info" style="color:#9ca3af;font-size:0.85rem">Take time to recover</span></div></div></div>';
                }
                html += '</div>';
            }
            container.innerHTML = html;
        }
        
        function isWorkoutCompletedOnDate(workoutId, date) {
            var dateStr = date.toDateString();
            return completedWorkouts.some(function(cw) {
                if (cw.id != workoutId) return false;
                return new Date(cw.date).toDateString() === dateStr;
            });
        }
        
        function renderCompletedWorkouts() {
            var container = document.getElementById('completedWorkoutsList');
            if (!container) return;
            
            if (completedWorkouts.length === 0) {
                container.innerHTML = '<div id="emptyCompletedWorkouts"><svg class="svg-icon mb-3" style="width:3rem;height:3rem;color:#dee2e6"><use href="#icon-dumbbell"></use></svg><p class="text-muted">No completed workouts yet.</p><a href="workouts.html" class="btn btn-sm btn-form-primary"><svg class="svg-icon me-1"><use href="#icon-plus"></use></svg>Browse Workouts</a></div>';
                return;
            }
            
            var sorted = completedWorkouts.slice().sort(function(a, b) { return new Date(b.date) - new Date(a.date); });
            var toShow = sorted.slice(0, 10);
            var html = '';
            
            toShow.forEach(function(item) {
                var date = new Date(item.date);
                var diffDays = Math.floor((new Date() - date) / (1000 * 60 * 60 * 24));
                var dateLabel = diffDays === 0 ? 'Today' : diffDays === 1 ? 'Yesterday' : diffDays < 7 ? diffDays + ' days ago' : date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                var timeStr = date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
                var levelClass = item.level === 'intermediate' ? 'level-intermediate' : item.level === 'advanced' ? 'level-advanced' : 'level-beginner';
                var calories = item.calories || CALORIES_BY_TYPE[item.type?.toLowerCase()] || CALORIES_BY_TYPE['default'];
                
                html += '<div class="completed-workout-item"><div class="d-flex justify-content-between align-items-start"><div><h6><svg class="svg-icon me-1" style="width:14px;height:14px"><use href="#icon-dumbbell"></use></svg>' + (item.name || 'Workout') + ' <small class="text-muted"><svg class="svg-icon me-1" style="width:12px;height:12px"><use href="#icon-flame"></use></svg>' + calories + ' cal</small></h6><small><svg class="svg-icon me-1" style="width:12px;height:12px"><use href="#icon-calendar"></use></svg>' + dateLabel + ' at ' + timeStr + '</small></div><span class="level-badge ' + levelClass + '"><svg class="svg-icon me-1" style="width:10px;height:10px"><use href="#icon-star"></use></svg>' + (item.level || 'beginner') + '</span></div></div>';
            });
            
            if (completedWorkouts.length > 10) html += '<div class="text-center mt-2"><small class="text-muted">Showing 10 of ' + completedWorkouts.length + ' workouts</small></div>';
            container.innerHTML = html;
        }
    })();
    </script>
</body>
</html>