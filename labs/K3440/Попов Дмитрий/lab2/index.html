<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>FRESH — Платформа фитнеса</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>

    <style>
        :root {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --bg: #f8fafc;
            --text: #1e293b;
            --sidebar-w: 280px;
        }

        html, body {
            height: 100%;
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif
        }

        .sidebar {
            width: var(--sidebar-w);
            min-height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            background: #111827;
            color: #fff;
            box-shadow: 2px 0 10px rgba(0, 0, 0, .12);
            z-index: 1000;
        }

        .sidebar .nav-link {
            color: #fff;
            opacity: .9;
            border-radius: .5rem;
            padding: .75rem 1rem
        }

        .sidebar .nav-link.active {
            background: var(--primary)
        }

        .sidebar .nav-link:hover {
            background: rgba(255, 255, 255, .1)
        }

        .main {
            margin-left: var(--sidebar-w);
            padding: 1.5rem
        }

        .page {
            display: none
        }

        .page.active {
            display: block
        }

        .card {
            border: none;
            border-radius: 1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, .08)
        }

        .hero {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #fff;
            padding: 3rem;
            border-radius: 1rem
        }

        .small-muted {
            color: #6b7280
        }
    </style>
</head>
<body>

<aside class="sidebar" id="sidebar">
    <div class="p-3 text-center">
        <div class="h4 fw-bold">FRESH</div>
        <div class="small text-white-50">Fitness & Health</div>
    </div>

    <nav class="nav flex-column px-2" id="mainNav">
        <a class="nav-link active" href="#" data-page="home" data-auth="any">Главная</a>
        <a class="nav-link" href="#" data-page="search" data-auth="any">Поиск</a>
        <a class="nav-link" href="#" data-page="dashboard" data-auth="auth">Кабинет</a>
        <a class="nav-link" href="#" data-page="login" data-auth="guest">Вход</a>
        <a class="btn btn-primary mt-3" href="#" data-page="register" data-auth="guest">Регистрация</a>
        <button class="btn btn-outline-light mt-3" id="logoutBtn" data-auth="auth" type="button">Выход</button>
    </nav>
</aside>

<main class="main">
    <section id="home" class="page active">
        <div class="hero mb-4">
            <h1 class="h3 fw-bold">Путь к здоровому образу жизни</h1>
            <p class="text-white-50">Тренировки, прогресс и планирование.</p>
            <a href="#" class="btn btn-light" data-page="search">Начать</a>
        </div>
    </section>

    <section id="login" class="page">
        <div class="card p-4" style="max-width:420px">
            <h2 class="h5 mb-3">Вход</h2>
            <form id="loginForm">
                <input id="loginEmail" type="email" class="form-control mb-2" placeholder="email@example.com" required>
                <input id="loginPassword" type="password" class="form-control mb-3" placeholder="Пароль" required>
                <button class="btn btn-primary w-100" type="submit">Войти</button>
            </form>
        </div>
    </section>

    <section id="register" class="page">
        <div class="card p-4" style="max-width:480px">
            <h2 class="h5 mb-3">Регистрация</h2>
            <form id="registrationForm">
                <input id="regName" type="text" class="form-control mb-2" placeholder="Имя" required>
                <input id="regEmail" type="email" class="form-control mb-2" placeholder="Email" required>
                <input id="regPassword" type="password" class="form-control mb-2" placeholder="Пароль" required>
                <input id="regPasswordConfirm" type="password" class="form-control mb-3" placeholder="Повторите пароль"
                       required>
                <button class="btn btn-primary w-100" type="submit">Создать аккаунт</button>
            </form>
        </div>
    </section>

    <section id="dashboard" class="page">
        <h2 class="h5">Личный кабинет — <span id="userNameDisplay"></span></h2>
        <p class="small-muted">Доступно только авторизованным пользователям</p>
        <div class="mt-3" id="dashboardContent"></div>
    </section>

    <section id="search" class="page">
        <h2 class="h5 mb-3">Тренировки</h2>
        <div class="row g-4">
            <aside class="col-md-4">
                <div class="card p-3">
                    <h3 class="h6">Фильтр</h3>
                    <div class="mb-2">
                        <label class="form-label small">Уровень</label>
                        <select id="filterLevel" class="form-select form-select-sm">
                            <option value="">Все</option>
                            <option value="beginner">Начинающий</option>
                            <option value="advanced">Продвинутый</option>
                        </select>
                    </div>
                    <div class="mb-2">
                        <label class="form-label small">Тип</label>
                        <select id="filterType" class="form-select form-select-sm">
                            <option value="">Все</option>
                            <option value="cardio">Кардио</option>
                            <option value="strength">Силовая</option>
                        </select>
                    </div>
                    <button id="applyFiltersBtn" class="btn btn-sm btn-primary w-100" type="button">Применить</button>
                </div>
            </aside>
            <div class="col-md-8">
                <div id="trainingResults"></div>
            </div>
        </div>
    </section>
</main>

<script>
    const API_BASE = 'http://localhost:3000';
    const QS = (s, r = document) => r.querySelector(s);
    const QSA = (s, r = document) => [...r.querySelectorAll(s)];

    function getToken() {
        return localStorage.getItem('token')
    }

    function getUser() {
        try {
            return JSON.parse(localStorage.getItem('user'))
        } catch {
            return null
        }
    }

    function setAuth(token, user) {
        localStorage.setItem('token', token);
        localStorage.setItem('user', JSON.stringify(user))
    }

    function clearAuth() {
        localStorage.removeItem('token');
        localStorage.removeItem('user')
    }

    async function apiFetch(path, options = {}) {
        const res = await fetch(API_BASE + path, options);
        if (!res.ok) throw new Error('API error');
        return res.json();
    }

    function updateNav() {
        const isAuth = !!getToken();
        QSA('[data-auth]').forEach(el => {
            if (el.dataset.auth === 'any') el.style.display = '';
            if (el.dataset.auth === 'auth') el.style.display = isAuth ? '' : 'none';
            if (el.dataset.auth === 'guest') el.style.display = !isAuth ? '' : 'none';
        });
    }

    function showPage(id) {
        QSA('.page').forEach(p => p.classList.remove('active'));
        QS('#' + id)?.classList.add('active');
        QSA('[data-page]').forEach(a => a.classList.toggle('active', a.dataset.page === id));
    }

    async function loadTrainings() {
        try {
            let data = await apiFetch('/trainings');
            const lvl = QS('#filterLevel').value;
            const type = QS('#filterType').value;
            if (lvl) data = data.filter(t => t.level === lvl);
            if (type) data = data.filter(t => t.type === type);
            const root = QS('#trainingResults');
            root.innerHTML = '';
            data.forEach(t => {
                root.innerHTML += `<div class="card p-3 mb-2"><strong>${t.title}</strong><div class="small text-muted">${t.level} · ${t.type} · ${t.duration} мин</div></div>`;
            });
        } catch (e) {
            QS('#trainingResults').innerHTML = '<div class="text-danger">Сервер недоступен</div>';
        }
    }

    QS('#applyFiltersBtn').onclick = loadTrainings;

    QS('#loginForm').onsubmit = async e => {
        e.preventDefault();
        try {
            const email = QS('#loginEmail').value;
            const pass = QS('#loginPassword').value;
            const users = await apiFetch('/users?email=' + encodeURIComponent(email));
            const user = users[0];
            if (!user || user.password !== pass) return alert('Неверный email или пароль');
            setAuth('mock-token', user);
            QS('#userNameDisplay').textContent = user.name;
            updateNav();
            showPage('dashboard');
        } catch {
            alert('Сервер недоступен')
        }
    };

    QS('#registrationForm').onsubmit = e => {
        e.preventDefault();
        alert('Регистрация через API (mock)')
    };
    QS('#logoutBtn').onclick = () => {
        clearAuth();
        updateNav();
        showPage('home')
    };

    document.addEventListener('click', e => {
        const a = e.target.closest('[data-page]');
        if (a) {
            e.preventDefault();
            showPage(a.dataset.page)
        }
    });

    document.addEventListener('DOMContentLoaded', () => {
        const u = getUser();
        if (u) QS('#userNameDisplay').textContent = u.name;
        updateNav();
        loadTrainings();
    });
</script>
</body>
</html>
