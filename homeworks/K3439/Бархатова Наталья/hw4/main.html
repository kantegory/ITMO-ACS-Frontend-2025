<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Поиск ресторанов</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/base.css">
    <link id="theme-style" rel="stylesheet" href="/css/theme-light.css">
    <script src="/js/theme.js" defer></script>
</head>
<body>

<header>
    <nav class="navbar navbar-dark" aria-label="Главная навигация">
        <div class="container d-flex align-items-center">
            <a class="navbar-brand" href="index.html">Вечер под контролем — сервис бронирования столов</a>
            <a class="navbar-brand" href="profile.html">Профиль</a>
        </div>
    </nav>
</header>

<main class="container mt-4">
    <section class="filter-section" aria-labelledby="filter-title">
        <h1 id="filter-title" class="mb-3 fs-4">Поиск ресторанов</h1>
        <form id="filterForm">
            <div class="row g-2">
                <div class="col-md-4">
                    <label for="filterCuisine" class="form-label small">Кухня</label>
                    <select id="filterCuisine" class="form-select form-select-sm">
                        <option value="">Все</option>
                        <option value="Italian">Итальянская</option>
                        <option value="Asian">Азиатская</option>
                        <option value="French">Французская</option>
                        <option value="North">Северная</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="filterLocation" class="form-label small">Расположение</label>
                    <select id="filterLocation" class="form-select form-select-sm">
                        <option value="">Все районы</option>
                        <option value="Centre">Центральный</option>
                        <option value="Primorsky">Приморский</option>
                        <option value="Autozavodsky">Автозаводский</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="filterPrice" class="form-label small">Ценовой сегмент</label>
                    <select id="filterPrice" class="form-select form-select-sm">
                        <option value="">Любой</option>
                        <option value="1">$</option>
                        <option value="2">$$</option>
                        <option value="3">$$$</option>
                    </select>
                </div>
            </div>
            <div class="mt-3 text-end">
                <button id="btnFilter" class="btn btn-primary btn-sm px-4" type="button">Применить</button>
            </div>
        </form>
    </section>

    <section id="restaurantsList" class="mt-4" aria-label="Список ресторанов">
        <p id="restaurantsMessage" class="visually-hidden" aria-live="polite"></p>
    </section>
</main>

<footer class="text-center mt-4 mb-4">
    <p>© 2025 Вечер под контролем</p>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    if (!localStorage.getItem("token")) {
        window.location.href = "login.html";
    }
    const cuisineMap = { Italian: "Итальянская", Asian: "Азиатская", French: "Французская", North: "Северная" };
    const locationMap = { Centre: "Центральный", Primorsky: "Приморский", Autozavodsky: "Автозаводский" };

    async function loadRestaurants() {
        try {
            const response = await fetch('http://localhost:3000/restaurants');
            restaurants = await response.json();
            renderRestaurants(restaurants);
        } catch (err) {
            console.error(err);
            document.getElementById("restaurantsList").innerHTML = "<p>Не удалось загрузить рестораны.</p>";
        }
    }

    function renderRestaurants(items) {
        const listContainer = document.getElementById("restaurantsList");
        listContainer.innerHTML = "";
        if (!items.length) {
            listContainer.innerHTML = "<p>Нет ресторанов, соответствующих фильтрам.</p>";
            return;
        }
        items.forEach(r => {
            const article = document.createElement("article");
            article.className = "restaurant-card";
            article.innerHTML = `
            <figure><img class="restaurant-img" src="${r.img}" alt="${r.name}"></figure>
            <div>
                <h2 class="restaurant-name fs-5"><a href="restaurant.html?id=${r.id}" class="text-decoration-none">${r.name}</a></h2>
                <p class="m-0">Кухня: ${cuisineMap[r.cuisine]}</p>
                <p class="m-0">Район: ${locationMap[r.location]}</p>
                <p class="m-0">Цена: ${'$'.repeat(r.price)}</p>
            </div>`;
            listContainer.append(article);
        });
    }

    document.getElementById("btnFilter").addEventListener("click", () => {
        const cuisine = document.getElementById("filterCuisine").value;
        const location = document.getElementById("filterLocation").value;
        const price = document.getElementById("filterPrice").value;

        const filtered = restaurants.filter(r =>
            (!cuisine || r.cuisine === cuisine) &&
            (!location || r.location === location) &&
            (!price || r.price === parseInt(price))
        );
        renderRestaurants(filtered);
    });

    loadRestaurants();
</script>
</body>
</html>
