<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Details - Fitness Platform</title>
    <meta name="description" content="Detailed information about the selected workout">
    <meta name="color-scheme" content="light dark">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Стили для страницы деталей как было */
        .workout-details-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .back-button {
            color: #1e40af;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border: 2px solid #1e40af;
            border-radius: 6px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin-bottom: 1.5rem;
        }
        
        .back-button:hover {
            background-color: #1e40af;
            color: white !important;
            transform: translateY(-2px);
        }
        
        .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .workout-title {
            color: #1e40af;
            font-weight: 800;
            font-size: 2.2rem;
            margin: 0;
        }
        
        .completion-badge {
            background: linear-gradient(135deg, #1e40af, #1e3a8a);
            color: white !important;
            font-weight: 700;
            padding: 0.6rem 1.5rem;
            border: 3px solid #1e3a8a;
            transition: all 0.3s ease;
        }
        
        .completion-badge:hover,
        .completion-badge:focus {
            background: linear-gradient(135deg, #1e3a8a, #1e1b4b);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 58, 138, 0.4);
        }
        
        .workout-image {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            background: #f8fafc;
            padding: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border-radius: 10px;
            padding: 1.25rem;
            text-align: center;
            border: 2px solid #bfdbfe;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: #1e40af;
            margin-bottom: 0.25rem;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #4b5563;
            font-weight: 600;
        }
        
        .description-section {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        
        .instructions-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .instruction-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border-top: 4px solid #2563eb;
        }
        
        .instruction-card h4 {
            color: #1e40af;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        @media (max-width: 768px) {
            .workout-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .instructions-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .workout-title {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container workout-details-container">
        <div>
            <a href="workouts.html" class="back-button" aria-label="Return to workouts list">
                <i class="fas fa-arrow-left me-2" aria-hidden="true"></i>Back to Workouts
            </a>
            <a href="../index.html" class="back-button ms-2" aria-label="Return to homepage">
                <i class="fas fa-home me-2" aria-hidden="true"></i>Back to Home
            </a>
        </div>
        
        <main id="main-content" tabindex="-1">
            <h1 class="visually-hidden">Workout Details - Detailed information about the selected workout</h1>
            
            <!-- Контент загружается через JS -->
            <div id="workoutContent">
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                        <span class="visually-hidden">Loading workout details...</span>
                    </div>
                    <p class="mt-3 h5">Loading workout details...</p>
                </div>
            </div>
        </main>
    </div>

    <script>
    // Используется тот же скрипт, что и ранее для загрузки деталей тренировки
    const API_URL = 'http://localhost:3000/api';
    
    const FALLBACK_WORKOUTS = [
        {
            id: 1,
            name: "Cardio Training",
            description: "Improve your endurance with our cardio exercises. Perfect for burning calories and strengthening your heart.",
            type: "cardio",
            level: "beginner",
            duration: "medium",
            calories: "300-400",
            equipment: "Treadmill, Jump Rope",
            image: "http://localhost:3000/images/cardio.jpeg",
            instructions: {
                warmup: "5 minutes of light jogging and dynamic stretching",
                main: "20 minutes of interval training with jumping jacks, high knees, and mountain climbers",
                cooldown: "5 minutes of stretching and deep breathing"
            }
        }
        // ... остальные данные такие же как в основном скрипте
    ];

    async function loadWorkoutDetails() {
        try {
            const urlParams = new URLSearchParams(window.location.search);
            const workoutId = urlParams.get('id');
            
            if (!workoutId) {
                showError('Workout ID not found in URL');
                return;
            }
            
            let workout;
            
            try {
                const response = await fetch(`${API_URL}/workouts/${workoutId}`);
                if (response.ok) {
                    workout = await response.json();
                    workout.image = getWorkoutImage(workout);
                } else {
                    throw new Error('API response not ok');
                }
            } catch (apiError) {
                console.log('API недоступен, использую локальные данные');
                workout = FALLBACK_WORKOUTS.find(w => w.id == workoutId) || FALLBACK_WORKOUTS[0];
            }
            
            if (!workout) {
                showError('Workout not found');
                return;
            }
            
            renderWorkoutDetails(workout);
            
        } catch (error) {
            console.error('Error loading workout details:', error);
            const urlParams = new URLSearchParams(window.location.search);
            const workoutId = urlParams.get('id') || '1';
            const workout = FALLBACK_WORKOUTS.find(w => w.id == workoutId) || FALLBACK_WORKOUTS[0];
            renderWorkoutDetails(workout);
        }
    }

    function getWorkoutImage(workout) {
        // Та же функция что и ранее
        if (workout.image && workout.image.startsWith('http')) {
            return workout.image;
        }
        
        const type = workout.type ? workout.type.toLowerCase() : 'default';
        const imageMap = {
            'cardio': 'http://localhost:3000/images/cardio.jpeg',
            'strength': 'http://localhost:3000/images/strength.jpeg',
            'yoga': 'http://localhost:3000/images/yoga.jpeg',
            'stretching': 'http://localhost:3000/images/stretching.jpeg',
            'hiit': 'http://localhost:3000/images/hiit.jpeg',
            'default': 'http://localhost:3000/images/workout.jpg'
        };
        
        return imageMap[type] || imageMap['default'];
    }

    function renderWorkoutDetails(workout) {
        const container = document.getElementById('workoutContent');
        
        // Получаем длительность в минутах
        let durationMinutes = '30 min';
        if (workout.duration === 'short') durationMinutes = '20 min';
        if (workout.duration === 'medium') durationMinutes = '30 min';
        if (workout.duration === 'long') durationMinutes = '45 min';
        
        // Проверяем, завершена ли тренировка
        const completedWorkouts = JSON.parse(localStorage.getItem('completedWorkouts') || '[]');
        const isCompleted = completedWorkouts.some(w => w.id == workout.id);
        
        container.innerHTML = `
            <div class="workout-header">
                <h2 class="workout-title">${workout.name}</h2>
                <button id="completeBtn" class="btn completion-badge">
                    <i class="${isCompleted ? 'fas' : 'far'} fa-check-circle me-1"></i>
                    ${isCompleted ? 'Completed' : 'Mark as Completed'}
                </button>
            </div>
            
            <img src="${workout.image}" 
                 class="workout-image" 
                 alt="${workout.name}"
                 onerror="this.src='http://localhost:3000/images/workout.jpg'">
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">${durationMinutes}</div>
                    <div class="stat-label">Duration</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${workout.calories || '300-400'}</div>
                    <div class="stat-label">Calories Burned</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${workout.level || 'Intermediate'}</div>
                    <div class="stat-label">Difficulty Level</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${workout.type || 'General'}</div>
                    <div class="stat-label">Workout Type</div>
                </div>
            </div>
            
            <div class="description-section">
                <h3 class="mb-3" style="color: #1e40af;">Description</h3>
                <p class="fs-5">${workout.description || 'No description available.'}</p>
                
                <div class="mt-4">
                    <h4 class="mb-3" style="color: #1e40af;">
                        <i class="fas fa-dumbbell me-2"></i>Equipment Needed
                    </h4>
                    <p>${workout.equipment || 'No equipment required'}</p>
                </div>
            </div>
            
            <div class="instructions-grid">
                <div class="instruction-card">
                    <h4>Warm-up</h4>
                    <p>${workout.instructions?.warmup || '5-10 minutes of light cardio and dynamic stretching to prepare your body.'}</p>
                </div>
                <div class="instruction-card">
                    <h4>Main Workout</h4>
                    <p>${workout.instructions?.main || 'Follow the workout plan focusing on proper form and technique.'}</p>
                </div>
                <div class="instruction-card">
                    <h4>Cool Down</h4>
                    <p>${workout.instructions?.cooldown || '5-10 minutes of stretching to aid recovery and prevent injury.'}</p>
                </div>
            </div>
        `;
        
        // Добавляем обработчик для кнопки завершения
        const completeBtn = document.getElementById('completeBtn');
        if (completeBtn) {
            completeBtn.addEventListener('click', () => {
                markWorkoutAsCompleted(workout);
            });
        }
    }

    function markWorkoutAsCompleted(workout) {
        const completedWorkouts = JSON.parse(localStorage.getItem('completedWorkouts') || '[]');
        
        // Проверяем, не завершена ли уже
        if (!completedWorkouts.some(w => w.id == workout.id)) {
            const completionDate = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
            
            const completedWorkout = {
                id: workout.id,
                name: workout.name,
                level: workout.level,
                date: new Date().toISOString(),
                displayDate: completionDate
            };
            
            completedWorkouts.push(completedWorkout);
            localStorage.setItem('completedWorkouts', JSON.stringify(completedWorkouts));
            
            // Обновляем UI
            const completeBtn = document.getElementById('completeBtn');
            if (completeBtn) {
                completeBtn.innerHTML = '<i class="fas fa-check-circle me-1"></i> Completed';
                completeBtn.classList.add('completed');
            }
            
            // Показываем уведомление
            showCompletionNotification(workout.name);
        }
    }

    function showCompletionNotification(workoutName) {
        // Создаем временное уведомление
        const notification = document.createElement('div');
        notification.className = 'alert alert-success position-fixed top-0 end-0 m-3';
        notification.style.zIndex = '9999';
        notification.style.minWidth = '300px';
        notification.innerHTML = `
            <div class="d-flex align-items-center">
                <i class="fas fa-check-circle fa-2x me-3"></i>
                <div>
                    <h5 class="mb-1">Workout Completed!</h5>
                    <p class="mb-0">"${workoutName}" has been added to your history.</p>
                </div>
            </div>
        `;
        
        document.body.appendChild(notification);
        
        // Удаляем через 3 секунды
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }

    function showError(message) {
        const container = document.getElementById('workoutContent');
        container.innerHTML = `
            <div class="alert alert-danger" role="alert">
                <i class="fas fa-exclamation-triangle me-2"></i>
                ${message}
            </div>
            <div class="text-center mt-4">
                <a href="workouts.html" class="btn btn-primary btn-lg">
                    <i class="fas fa-arrow-left me-2"></i>
                    Back to Workouts
                </a>
            </div>
        `;
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadWorkoutDetails();
        
        // Устанавливаем фокус на основном контенте
        const mainContent = document.getElementById('main-content');
        if (mainContent) {
            mainContent.focus();
        }
    });
    </script>
</body>
</html>