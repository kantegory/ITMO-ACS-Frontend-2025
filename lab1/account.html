document.addEventListener('DOMContentLoaded', async () => {
  const currentUser = JSON.parse(localStorage.getItem('currentUser'));
  if (!currentUser) return window.location.href = 'login.html';

  document.getElementById('userGreeting').textContent = `Добро пожаловать, ${currentUser.name}!`;

  document.getElementById('logoutBtn').addEventListener('click', () => {
    localStorage.removeItem('currentUser');
    window.location.href = 'login.html';
  });

  // получаем бронирования с сервера
  try {
    const res = await fetch(`http://localhost:3000/bookings?email=${encodeURIComponent(currentUser.email)}`);
    const bookings = await res.json();

    const userBookings = document.getElementById('userBookings');
    if (!bookings.length) {
      userBookings.innerHTML = '<p class="text-muted">Бронирований пока нет</p>';
    } else {
      userBookings.innerHTML = '';
      bookings.forEach(b => {
        const item = document.createElement('div');
        item.className = 'list-group-item';
        item.innerHTML = `
          <h5>${b.name}</h5>
          <p class="mb-1">Дата: ${b.date}</p>
          <small>Гостей: ${b.guests}</small>
        `;
        userBookings.appendChild(item);
      });
    }
  } catch (err) {
    document.getElementById('userBookings').innerHTML = '<p class="text-danger">Ошибка загрузки бронирований</p>';
    console.error(err);
  }
});

